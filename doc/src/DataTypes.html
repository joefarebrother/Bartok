<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Trustworthy #-}</span><span>
</span><a name="line-2"></a><span class="hs-pragma">{-# LANGUAGE TemplateHaskell, ScopedTypeVariables #-}</span><span>
</span><a name="line-3"></a><span class="hs-comment">{-|
Module      : DataTypes
Description : Data types used for dealing with games

Datatypes for cards, game state and game view alongside some basic functions to process them.
-}</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">DataTypes</span><span class="hs-special">(</span><span>
</span><a name="line-10"></a><span>
</span><a name="line-11"></a><span>    </span><span class="hs-comment">-- *Basic Rules</span><span>
</span><a name="line-12"></a><span>    </span><a href="DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span class="hs-special">,</span><a href="DataTypes.html#Game"><span class="hs-identifier hs-type">Game</span></a><span class="hs-special">,</span><span> </span><a href="DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span>    </span><span class="hs-comment">-- **Structures</span><span>
</span><a name="line-14"></a><span>    </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><span>    </span><a href="DataTypes.html#Action"><span class="hs-identifier hs-type">Action</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DataTypes.html#Event"><span class="hs-identifier hs-type">Event</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span>    </span><a href="DataTypes.html#newGame"><span class="hs-identifier hs-var">newGame</span></a><span class="hs-special">,</span><span>
</span><a name="line-17"></a><span>
</span><a name="line-18"></a><span>    </span><span class="hs-comment">-- **Cards</span><span>
</span><a name="line-19"></a><span>    </span><a href="DataTypes.html#Hand"><span class="hs-identifier hs-type">Hand</span></a><span class="hs-special">,</span><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><span>    </span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="DataTypes.html#suit"><span class="hs-identifier hs-var">suit</span></a><span class="hs-special">,</span><span> </span><a href="DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span>    </span><span class="hs-comment">-- ** Variables</span><span>
</span><a name="line-22"></a><span>    </span><span class="hs-comment">-- Game states may store named variables that can be read and written to by rules</span><span>
</span><a name="line-23"></a><span>    </span><a href="DataTypes.html#VarName"><span class="hs-identifier hs-type">VarName</span></a><span class="hs-special">,</span><a href="DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span class="hs-special">,</span><a href="DataTypes.html#readVar"><span class="hs-identifier hs-var">readVar</span></a><span class="hs-special">,</span><a href="DataTypes.html#modifyVar"><span class="hs-identifier hs-var">modifyVar</span></a><span class="hs-special">,</span><span>
</span><a name="line-24"></a><span>
</span><a name="line-25"></a><span>    </span><span class="hs-comment">-- **other functions</span><span>
</span><a name="line-26"></a><span>    </span><a href="DataTypes.html#shuffleDeck"><span class="hs-identifier hs-var">shuffleDeck</span></a><span class="hs-special">,</span><a href="DataTypes.html#eventPlayer"><span class="hs-identifier hs-var">eventPlayer</span></a><span class="hs-special">,</span><span>
</span><a name="line-27"></a><span>
</span><a name="line-28"></a><span>    </span><span class="hs-comment">-- * View Rules</span><span>
</span><a name="line-29"></a><span>    </span><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span class="hs-special">,</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span class="hs-special">,</span><span> </span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-30"></a><span>    </span><span class="hs-comment">-- **Structure</span><span>
</span><a name="line-31"></a><span>    </span><a href="DataTypes.html#GameView"><span class="hs-identifier hs-type">GameView</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span>
</span><a name="line-34"></a><span>    </span><span class="hs-comment">-- * Combined Rules</span><span>
</span><a name="line-35"></a><span>    </span><a href="DataTypes.html#Rule%27"><span class="hs-identifier hs-type">Rule'</span></a><span class="hs-special">,</span><span>
</span><a name="line-36"></a><span>
</span><a name="line-37"></a><span>    </span><span class="hs-comment">-- *Cards</span><span>
</span><a name="line-38"></a><span>    </span><span class="hs-comment">-- **Printing</span><span>
</span><a name="line-39"></a><span>    </span><a href="DataTypes.html#uniCard"><span class="hs-identifier hs-var">uniCard</span></a><span class="hs-special">,</span><span>
</span><a name="line-40"></a><span>    </span><span class="hs-comment">-- **Parsing</span><span>
</span><a name="line-41"></a><span>    </span><span class="hs-comment">-- these don't matter too much</span><span>
</span><a name="line-42"></a><span>    </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span class="hs-special">,</span><a href="DataTypes.html#runParser"><span class="hs-identifier hs-var">runParser</span></a><span class="hs-special">,</span><a href="DataTypes.html#parseSuit"><span class="hs-identifier hs-var">parseSuit</span></a><span class="hs-special">,</span><a href="DataTypes.html#parseRank"><span class="hs-identifier hs-var">parseRank</span></a><span class="hs-special">,</span><a href="DataTypes.html#parseCard"><span class="hs-identifier hs-var">parseCard</span></a><span class="hs-special">,</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span>    </span><span class="hs-comment">-- * Other types used</span><span>
</span><a name="line-45"></a><span>    </span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">:|</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-46"></a><span>    </span><span class="hs-identifier hs-type">Map</span><span class="hs-special">,</span><span>
</span><a name="line-47"></a><span>    </span><span class="hs-identifier hs-type">StdGen</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">randomR</span><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-var">random</span><span class="hs-special">,</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span>    </span><span class="hs-comment">-- *Angus needs to get rid of these</span><span>
</span><a name="line-50"></a><span>    </span><a href="DataTypes.html#if%27"><span class="hs-identifier hs-var">if'</span></a><span class="hs-special">,</span><span class="hs-special">(</span><a href="DataTypes.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-51"></a><span>    </span><span class="hs-comment">-- **lenses</span><span>
</span><a name="line-52"></a><span>    </span><a href="DataTypes.html#players"><span class="hs-identifier hs-var">players</span></a><span class="hs-special">,</span><span>
</span><a name="line-53"></a><span>    </span><a href="DataTypes.html#hands"><span class="hs-identifier hs-var">hands</span></a><span class="hs-special">,</span><span>
</span><a name="line-54"></a><span>    </span><a href="DataTypes.html#deck"><span class="hs-identifier hs-var">deck</span></a><span class="hs-special">,</span><span>
</span><a name="line-55"></a><span>    </span><a href="DataTypes.html#pile"><span class="hs-identifier hs-var">pile</span></a><span class="hs-special">,</span><span>
</span><a name="line-56"></a><span>    </span><a href="DataTypes.html#messages"><span class="hs-identifier hs-var">messages</span></a><span class="hs-special">,</span><span>
</span><a name="line-57"></a><span>    </span><a href="DataTypes.html#lastMoveLegal"><span class="hs-identifier hs-var">lastMoveLegal</span></a><span class="hs-special">,</span><span>
</span><a name="line-58"></a><span>    </span><a href="DataTypes.html#randg"><span class="hs-identifier hs-var">randg</span></a><span class="hs-special">,</span><span>
</span><a name="line-59"></a><span>    </span><a href="DataTypes.html#winner"><span class="hs-identifier hs-var">winner</span></a><span class="hs-special">,</span><span>
</span><a name="line-60"></a><span>    </span><a href="DataTypes.html#varMap"><span class="hs-identifier hs-var">varMap</span></a><span class="hs-special">,</span><span>
</span><a name="line-61"></a><span>    </span><a href="DataTypes.html#handsV"><span class="hs-identifier hs-var">handsV</span></a><span class="hs-special">,</span><span>
</span><a name="line-62"></a><span>    </span><a href="DataTypes.html#pileV"><span class="hs-identifier hs-var">pileV</span></a><span class="hs-special">,</span><span>
</span><a name="line-63"></a><span>    </span><a href="DataTypes.html#deckV"><span class="hs-identifier hs-var">deckV</span></a><span class="hs-special">,</span><span>
</span><a name="line-64"></a><span>    </span><a href="DataTypes.html#messagesV"><span class="hs-identifier hs-var">messagesV</span></a><span class="hs-special">,</span><span>
</span><a name="line-65"></a><span class="hs-special">)</span><span>
</span><a name="line-66"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-67"></a><span>
</span><a name="line-68"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Lens</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">^.</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator hs-var">%~</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">makeLenses</span><span class="hs-special">,</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">%%~</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator hs-var">&amp;</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Lens'</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Lens</span><span class="hs-special">)</span><span>
</span><a name="line-69"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ap</span><span class="hs-special">,</span><span class="hs-identifier hs-var">liftM2</span><span class="hs-special">)</span><span>
</span><a name="line-70"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad.Trans.State</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">StateT</span><span class="hs-special">(</span><span class="hs-identifier hs-var">StateT</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">evalStateT</span><span class="hs-special">,</span><span class="hs-identifier hs-var">runStateT</span><span class="hs-special">)</span><span>
</span><a name="line-71"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Char</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toLower</span><span class="hs-special">,</span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span>
</span><a name="line-72"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">isPrefixOf</span><span class="hs-special">,</span><span class="hs-identifier hs-var">stripPrefix</span><span class="hs-special">)</span><span>
</span><a name="line-73"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span>
</span><a name="line-74"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-75"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Map</span><span class="hs-special">)</span><span>
</span><a name="line-76"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">empty</span><span class="hs-special">,</span><span class="hs-identifier hs-var">findWithDefault</span><span class="hs-special">,</span><span class="hs-identifier hs-var">fromList</span><span class="hs-special">,</span><span class="hs-identifier hs-var">insert</span><span class="hs-special">,</span><span class="hs-identifier hs-var">map</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- (insert,findWithDefault,empty,fromList)</span><span>
</span><a name="line-77"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.Maybe</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">listToMaybe</span><span class="hs-special">)</span><span>
</span><a name="line-78"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Random</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">StdGen</span><span class="hs-special">,</span><span class="hs-identifier hs-var">mkStdGen</span><span class="hs-special">,</span><span class="hs-identifier hs-var">split</span><span class="hs-special">,</span><span class="hs-identifier hs-var">random</span><span class="hs-special">,</span><span class="hs-identifier hs-var">randomR</span><span class="hs-special">)</span><span>
</span><a name="line-79"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">System.Random.Shuffle</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">shuffle'</span><span class="hs-special">)</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-identifier">if'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679087860"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679087860"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679087860"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-85"></a><a name="if%27"><a href="DataTypes.html#if%27"><span class="hs-identifier">if'</span></a></a><span> </span><a name="local-6989586621679087861"><a href="#local-6989586621679087861"><span class="hs-identifier">b</span></a></a><span> </span><a name="local-6989586621679087862"><a href="#local-6989586621679087862"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679087863"><a href="#local-6989586621679087863"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679087861"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679087862"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679087863"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-86"></a><span>
</span><a name="line-87"></a><span class="hs-keyword">data</span><span> </span><a name="Suit"><a href="DataTypes.html#Suit"><span class="hs-identifier">Suit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Clubs"><a href="DataTypes.html#Clubs"><span class="hs-identifier">Clubs</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Diamonds"><a href="DataTypes.html#Diamonds"><span class="hs-identifier">Diamonds</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Hearts"><a href="DataTypes.html#Hearts"><span class="hs-identifier">Hearts</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Spades"><a href="DataTypes.html#Spades"><span class="hs-identifier">Spades</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Enum</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-88"></a><span class="hs-keyword">data</span><span> </span><a name="Rank"><a href="DataTypes.html#Rank"><span class="hs-identifier">Rank</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Ace"><a href="DataTypes.html#Ace"><span class="hs-identifier">Ace</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Two"><a href="DataTypes.html#Two"><span class="hs-identifier">Two</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Three"><a href="DataTypes.html#Three"><span class="hs-identifier">Three</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Four"><a href="DataTypes.html#Four"><span class="hs-identifier">Four</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Five"><a href="DataTypes.html#Five"><span class="hs-identifier">Five</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Six"><a href="DataTypes.html#Six"><span class="hs-identifier">Six</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Seven"><a href="DataTypes.html#Seven"><span class="hs-identifier">Seven</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Eight"><a href="DataTypes.html#Eight"><span class="hs-identifier">Eight</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Nine"><a href="DataTypes.html#Nine"><span class="hs-identifier">Nine</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Ten"><a href="DataTypes.html#Ten"><span class="hs-identifier">Ten</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Jack"><a href="DataTypes.html#Jack"><span class="hs-identifier">Jack</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Knight"><a href="DataTypes.html#Knight"><span class="hs-identifier">Knight</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="Queen"><a href="DataTypes.html#Queen"><span class="hs-identifier">Queen</span></a></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="King"><a href="DataTypes.html#King"><span class="hs-identifier">King</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Bounded</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Ord</span><span class="hs-special">)</span><span>
</span><a name="line-89"></a><span class="hs-comment">-- data Rank' = Fool | Individual | Childhood | Youth | Maturity | OldAge | Morning | Afternoon</span><span>
</span><a name="line-90"></a><span class="hs-comment">--            | Evening | Night | EarthAir | WaterFire | Dance | Shopping | OpenAir | VisualArts</span><span>
</span><a name="line-91"></a><span class="hs-comment">--            | Spring | Summer | Autumn | Winter | TheGame | Collective deriving (Show,Eq,Enum,Bounded)</span><span>
</span><a name="line-92"></a><span class="hs-comment">-- data JColour = Red | Black | White deriving (Show,Eq,Enum,Bounded)</span><span>
</span><a name="line-93"></a><span class="hs-comment">--</span><span>
</span><a name="line-94"></a><span class="hs-comment">-- data Suit = Clubs | .. | Trumps | Black | Red | White</span><span>
</span><a name="line-95"></a><span class="hs-comment">-- data Rank = Ace .. King | Joker | Fool ... Collective</span><span>
</span><a name="line-96"></a><span class="hs-comment">-- data Card = SCard Rank Suit | Trump Rank' | Joker JColour deriving (Show,Eq)</span><span>
</span><a name="line-97"></a><span>
</span><a name="line-98"></a><span class="hs-comment">-- | A single playing card</span><span>
</span><a name="line-99"></a><span class="hs-keyword">type</span><span> </span><a name="Card"><a href="DataTypes.html#Card"><span class="hs-identifier">Card</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span class="hs-special">,</span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>
</span><a name="line-101"></a><span class="hs-comment">-- | An ordered collection of cards forming a player's hand</span><span>
</span><a name="line-102"></a><span class="hs-keyword">type</span><span> </span><a name="Hand"><a href="DataTypes.html#Hand"><span class="hs-identifier">Hand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span>
</span><a name="line-103"></a><span>
</span><a name="line-104"></a><span class="hs-comment">-- | Names of players.</span><span>
</span><a name="line-105"></a><span class="hs-keyword">type</span><span> </span><a name="Name"><a href="DataTypes.html#Name"><span class="hs-identifier">Name</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- | At any point, a player can attempt to take one of these actions</span><span>
</span><a name="line-108"></a><span class="hs-keyword">data</span><span> </span><a name="Action"><a href="DataTypes.html#Action"><span class="hs-identifier">Action</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="Draw"><a href="DataTypes.html#Draw"><span class="hs-identifier">Draw</span></a></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">|</span><span> </span><a name="Play"><a href="DataTypes.html#Play"><span class="hs-identifier">Play</span></a></a><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-109"></a><span>
</span><a name="line-110"></a><span class="hs-comment">-- | Events that rules should be able to deal with</span><span>
</span><a name="line-111"></a><span class="hs-keyword">data</span><span> </span><a name="Event"><a href="DataTypes.html#Event"><span class="hs-identifier">Event</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-112"></a><span>      </span><a name="PlayerLeave"><a href="DataTypes.html#PlayerLeave"><span class="hs-identifier">PlayerLeave</span></a></a><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-comment">-- ^A player leaving the game</span><span>
</span><a name="line-113"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="PlayerJoin"><a href="DataTypes.html#PlayerJoin"><span class="hs-identifier">PlayerJoin</span></a></a><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-comment">-- ^A player requesting to join the game. This is not limited to the start</span><span>
</span><a name="line-114"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Action"><a href="DataTypes.html#Action"><span class="hs-identifier">Action</span></a></a><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="DataTypes.html#Action"><span class="hs-identifier hs-type">Action</span></a><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-comment">-- ^A player performing one of the above actions and sending a message.</span><span>
</span><a name="line-115"></a><span>    </span><span class="hs-glyph">|</span><span> </span><a name="Timeout"><a href="DataTypes.html#Timeout"><span class="hs-identifier">Timeout</span></a></a><span> </span><span class="hs-comment">-- ^If no player has made an action for 10 seconds, this event will be sent</span><span>
</span><a name="line-116"></a><span>    </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">,</span><span class="hs-identifier hs-type">Eq</span><span class="hs-special">)</span><span>
</span><a name="line-117"></a><span>
</span><a name="line-118"></a><span class="hs-comment">-- | The type of transformations of game state</span><span>
</span><a name="line-119"></a><span class="hs-keyword">type</span><span> </span><a name="Step"><a href="DataTypes.html#Step"><span class="hs-identifier">Step</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span>
</span><a name="line-120"></a><span>
</span><a name="line-121"></a><span class="hs-comment">-- I'd call a function playmove or runevent. the problem is that it's used more than once</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-comment">-- | This is the type of games (meaning a ruleset, rather than a specific instance of a game).</span><span>
</span><a name="line-124"></a><span class="hs-comment">-- Given an event such as a player action, and a game state, it returns the resulting state</span><span>
</span><a name="line-125"></a><span class="hs-keyword">type</span><span> </span><a name="Game"><a href="DataTypes.html#Game"><span class="hs-identifier">Game</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span>
</span><a name="line-126"></a><span>
</span><a name="line-127"></a><span class="hs-comment">-- | The type of rules - a rule is added by function composition forming a chain</span><span>
</span><a name="line-128"></a><span class="hs-comment">-- such as 'r3 (r1 (r2 baseAct))' .</span><span>
</span><a name="line-129"></a><span class="hs-comment">-- Most rules should call the first argument under most circumstances and usually without changing the event.</span><span>
</span><a name="line-130"></a><span class="hs-keyword">type</span><span> </span><a name="Rule"><a href="DataTypes.html#Rule"><span class="hs-identifier">Rule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#Game"><span class="hs-identifier hs-type">Game</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Game"><span class="hs-identifier hs-type">Game</span></a><span>
</span><a name="line-131"></a><span class="hs-comment">-- ^ Game -&gt; Game == (Event -&gt; GameState -&gt; GameState) -&gt; Event -&gt; GameState -&gt; GameState</span><span>
</span><a name="line-132"></a><span>
</span><a name="line-133"></a><span class="hs-comment">-- \ Identifiers for variables</span><span>
</span><a name="line-134"></a><span class="hs-keyword">type</span><span> </span><a name="VarName"><a href="DataTypes.html#VarName"><span class="hs-identifier">VarName</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">String</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">--TODO: make the documentation true (messages and lastMoveLegal)</span><span>
</span><a name="line-137"></a><span class="hs-comment">-- | The state of a game in play</span><span>
</span><a name="line-138"></a><span class="hs-keyword">data</span><span> </span><a name="GameState"><a href="DataTypes.html#GameState"><span class="hs-identifier">GameState</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GS"><a href="DataTypes.html#GS"><span class="hs-identifier">GS</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-139"></a><span>       </span><a name="_players"><a href="DataTypes.html#_players"><span class="hs-identifier">_players</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The players curretly in the game. The player whose turn it is should be at head of list</span><span>
</span><a name="line-140"></a><span>       </span><span class="hs-comment">-- and usually this advances forward by 1 each turn.</span><span>
</span><a name="line-141"></a><span>       </span><a name="_hands"><a href="DataTypes.html#_hands"><span class="hs-identifier">_hands</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><a href="DataTypes.html#Hand"><span class="hs-identifier hs-type">Hand</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Stores the contents of each player's hand</span><span>
</span><a name="line-142"></a><span>       </span><a name="_deck"><a href="DataTypes.html#_deck"><span class="hs-identifier">_deck</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The deck from which cards are drawn</span><span>
</span><a name="line-143"></a><span>       </span><a name="_pile"><a href="DataTypes.html#_pile"><span class="hs-identifier">_pile</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">NonEmpty</span><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The cards that have been played -</span><span>
</span><a name="line-144"></a><span>       </span><a name="_messages"><a href="DataTypes.html#_messages"><span class="hs-identifier">_messages</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The messages that .  Contains only those generated by the most recent event.</span><span>
</span><a name="line-145"></a><span>       </span><a name="_lastMoveLegal"><a href="DataTypes.html#_lastMoveLegal"><span class="hs-identifier">_lastMoveLegal</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Bool</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ Indicates if the last move was successful.</span><span>
</span><a name="line-146"></a><span>           </span><span class="hs-comment">-- This should be true</span><span>
</span><a name="line-147"></a><span>           </span><span class="hs-comment">-- When a new event happens, this is False until baseAct is called.</span><span>
</span><a name="line-148"></a><span>       </span><span class="hs-comment">--_prevGS :: Maybe (GameState,Action),</span><span>
</span><a name="line-149"></a><span>
</span><a name="line-150"></a><span>       </span><a name="_randg"><a href="DataTypes.html#_randg"><span class="hs-identifier">_randg</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">StdGen</span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ A seeded random number generator so that you can</span><span>
</span><a name="line-151"></a><span>       </span><a name="_winner"><a href="DataTypes.html#_winner"><span class="hs-identifier">_winner</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ @Nothing@ until a player p wins at which point it becomes @Just p@</span><span>
</span><a name="line-152"></a><span>       </span><a name="_varMap"><a href="DataTypes.html#_varMap"><span class="hs-identifier">_varMap</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Map</span><span> </span><a href="DataTypes.html#VarName"><span class="hs-identifier hs-type">VarName</span></a><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-comment">-- ^ A store of named variables that rules may use to keep track of state between events.</span><span>
</span><a name="line-153"></a><span>     </span><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-154"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">GameState</span><span>
</span><a name="line-155"></a><span class="hs-comment">-- players :: Lens' GameState [Name]</span><span>
</span><a name="line-156"></a><span class="hs-comment">-- players f gs@GS{_players = p} = (\p' -&gt; gs{_players = p'}) &lt;$&gt; f p</span><span>
</span><a name="line-157"></a><span class="hs-comment">-- seats :: Lens' GameState [Name]</span><span>
</span><a name="line-158"></a><span class="hs-comment">-- seats f gs@GS{_seats = s} = (\s' -&gt; gs{_seats = s'}) &lt;$&gt; f s</span><span>
</span><a name="line-159"></a><span class="hs-comment">-- hands :: Lens' GameState (Map Name Hand)</span><span>
</span><a name="line-160"></a><span class="hs-comment">-- hands f gs@GS{_hands = h} = (\h' -&gt; gs{_hands = h'}) &lt;$&gt; f h</span><span>
</span><a name="line-161"></a><span class="hs-comment">-- deck :: Lens' GameState [Card]</span><span>
</span><a name="line-162"></a><span class="hs-comment">-- deck f gs@GS{_deck = d} = (\d' -&gt; gs{_deck = d'}) &lt;$&gt; f d</span><span>
</span><a name="line-163"></a><span class="hs-comment">-- pile :: Lens' GameState (NonEmpty Card)</span><span>
</span><a name="line-164"></a><span class="hs-comment">-- pile f gs@GS{_pile = p} = (\p' -&gt; gs{_pile = p'}) &lt;$&gt; f p</span><span>
</span><a name="line-165"></a><span class="hs-comment">-- messages :: Lens' GameState [String]</span><span>
</span><a name="line-166"></a><span class="hs-comment">-- messages f gs@GS{_messages = m} = (\m' -&gt; gs{_messages = m'}) &lt;$&gt; f m</span><span>
</span><a name="line-167"></a><span class="hs-comment">-- lastMoveLegal :: Lens' GameState Bool</span><span>
</span><a name="line-168"></a><span class="hs-comment">-- lastMoveLegal f gs@GS{_lastMoveLegal = b} = (\b' -&gt; gs{_lastMoveLegal = b'}) &lt;$&gt; f b</span><span>
</span><a name="line-169"></a><span class="hs-comment">-- randg :: Lens' GameState StdGen</span><span>
</span><a name="line-170"></a><span class="hs-comment">-- randg f gs@GS{_randg = r} = (\r' -&gt; gs{_randg = r'}) &lt;$&gt; f r</span><span>
</span><a name="line-171"></a><span class="hs-comment">-- winner :: Lens' GameState (Maybe Name)</span><span>
</span><a name="line-172"></a><span class="hs-comment">-- winner f gs@GS{_winner = w} = (\w' -&gt; gs{_winner = w'}) &lt;$&gt; f w</span><span>
</span><a name="line-173"></a><span class="hs-comment">-- varMap :: Lens' GameState (Map String Int)</span><span>
</span><a name="line-174"></a><span class="hs-comment">-- varMap f gs@GS{_varMap = v} = (\v' -&gt; gs{_varMap = v'}) &lt;$&gt; f v</span><span>
</span><a name="line-175"></a><span>
</span><a name="line-176"></a><span class="hs-comment">-- | A card as viewed - the type of cards sent to the client</span><span>
</span><a name="line-177"></a><span class="hs-keyword">data</span><span> </span><a name="CardView"><a href="DataTypes.html#CardView"><span class="hs-identifier">CardView</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="CardFace"><a href="DataTypes.html#CardFace"><span class="hs-identifier">CardFace</span></a></a><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="CardBack"><a href="DataTypes.html#CardBack"><span class="hs-identifier">CardBack</span></a></a><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Show</span><span class="hs-special">)</span><span>
</span><a name="line-178"></a><span>
</span><a name="line-179"></a><span class="hs-comment">-- | The structure describing data seen by players</span><span>
</span><a name="line-180"></a><span class="hs-keyword">data</span><span> </span><a name="GameView"><a href="DataTypes.html#GameView"><span class="hs-identifier">GameView</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a name="GV"><a href="DataTypes.html#GV"><span class="hs-identifier">GV</span></a></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-181"></a><span>    </span><a name="_handsV"><a href="DataTypes.html#_handsV"><span class="hs-identifier">_handsV</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ The players and the information a particular player will have about each hand.</span><span>
</span><a name="line-182"></a><span>    </span><span class="hs-comment">-- By default, this is a 'CardFace's for the viewing player and a number of 'CardBack's for others.</span><span>
</span><a name="line-183"></a><span>    </span><a name="_pileV"><a href="DataTypes.html#_pileV"><span class="hs-identifier">_pileV</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ What should be seen of the pile. By default, only the top card is visible.</span><span>
</span><a name="line-184"></a><span>    </span><a name="_deckV"><a href="DataTypes.html#_deckV"><span class="hs-identifier">_deckV</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span> </span><span class="hs-special">,</span><span> </span><span class="hs-comment">-- ^ What should be seen of the pile. By default, none are visible.</span><span>
</span><a name="line-185"></a><span>    </span><a name="_messagesV"><a href="DataTypes.html#_messagesV"><span class="hs-identifier">_messagesV</span></a></a><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-comment">-- ^ The messages a player can see. By default, this is all messages that have been sent</span><span>
</span><a name="line-186"></a><span class="hs-special">}</span><span> </span><span class="hs-keyword">deriving</span><span> </span><span class="hs-identifier hs-type">Show</span><span>
</span><a name="line-187"></a><span class="hs-identifier hs-var">makeLenses</span><span> </span><span class="hs-special">''</span><span class="hs-identifier hs-var">GameView</span><span>
</span><a name="line-188"></a><span class="hs-comment">-- handsV :: Lens' GameView [(Name,[CardView])]</span><span>
</span><a name="line-189"></a><span class="hs-comment">-- handsV f gv@GV{_handsV = h} = (\h' -&gt; gv{_handsV = h'}) &lt;$&gt; f h</span><span>
</span><a name="line-190"></a><span class="hs-comment">-- deckV :: Lens' GameView  [CardView]</span><span>
</span><a name="line-191"></a><span class="hs-comment">-- deckV f gv@GV{_deckV = d} = (\d' -&gt; gv{_deckV = d'}) &lt;$&gt; f d</span><span>
</span><a name="line-192"></a><span class="hs-comment">-- pileV :: Lens' GameView  [CardView]</span><span>
</span><a name="line-193"></a><span class="hs-comment">-- pileV f gv@GV{_pileV = p} = (\p' -&gt; gv{_pileV = p'}) &lt;$&gt; f p</span><span>
</span><a name="line-194"></a><span class="hs-comment">-- messagesV :: Lens' GameView  [String]</span><span>
</span><a name="line-195"></a><span class="hs-comment">-- messagesV f gv@GV{_messagesV = m} = (\m' -&gt; gv{_messagesV = m'}) &lt;$&gt; f m</span><span>
</span><a name="line-196"></a><span>
</span><a name="line-197"></a><span class="hs-comment">-- | Functions to tell a player what they should see</span><span>
</span><a name="line-198"></a><span class="hs-keyword">type</span><span> </span><a name="Viewer"><a href="DataTypes.html#Viewer"><span class="hs-identifier">Viewer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameView"><span class="hs-identifier hs-type">GameView</span></a><span>
</span><a name="line-199"></a><span>
</span><a name="line-200"></a><span class="hs-comment">-- | Rules that modify what players see without affecting the game state</span><span>
</span><a name="line-201"></a><span class="hs-keyword">type</span><span> </span><a name="ViewRule"><a href="DataTypes.html#ViewRule"><span class="hs-identifier">ViewRule</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span>
</span><a name="line-202"></a><span>
</span><a name="line-203"></a><span class="hs-comment">-- | Complex rules</span><span>
</span><a name="line-204"></a><span class="hs-keyword">type</span><span> </span><a name="Rule%27"><a href="DataTypes.html#Rule%27"><span class="hs-identifier">Rule'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span class="hs-special">,</span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span class="hs-special">)</span><span>
</span><a name="line-205"></a><span>
</span><a name="line-206"></a><span>
</span><a name="line-207"></a><span>
</span><a name="line-208"></a><span class="hs-comment">-- Enum instances</span><span>
</span><a name="line-209"></a><span>
</span><a name="line-210"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-211"></a><span>  </span><a name="local-8214565720323790777"><span class="hs-identifier">toEnum</span></a><span> </span><a name="local-6989586621679093794"><a href="#local-6989586621679093794"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093794"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-212"></a><span>    </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Ace"><span class="hs-identifier hs-var">Ace</span></a><span>
</span><a name="line-213"></a><span>    </span><span class="hs-number">2</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Two"><span class="hs-identifier hs-var">Two</span></a><span>
</span><a name="line-214"></a><span>    </span><span class="hs-number">3</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Three"><span class="hs-identifier hs-var">Three</span></a><span>
</span><a name="line-215"></a><span>    </span><span class="hs-number">4</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Four"><span class="hs-identifier hs-var">Four</span></a><span>
</span><a name="line-216"></a><span>    </span><span class="hs-number">5</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Five"><span class="hs-identifier hs-var">Five</span></a><span>
</span><a name="line-217"></a><span>    </span><span class="hs-number">6</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Six"><span class="hs-identifier hs-var">Six</span></a><span>
</span><a name="line-218"></a><span>    </span><span class="hs-number">7</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Seven"><span class="hs-identifier hs-var">Seven</span></a><span>
</span><a name="line-219"></a><span>    </span><span class="hs-number">8</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Eight"><span class="hs-identifier hs-var">Eight</span></a><span>
</span><a name="line-220"></a><span>    </span><span class="hs-number">9</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Nine"><span class="hs-identifier hs-var">Nine</span></a><span>
</span><a name="line-221"></a><span>    </span><span class="hs-number">10</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Ten"><span class="hs-identifier hs-var">Ten</span></a><span>
</span><a name="line-222"></a><span>    </span><span class="hs-number">11</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Jack"><span class="hs-identifier hs-var">Jack</span></a><span>
</span><a name="line-223"></a><span>    </span><span class="hs-number">12</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Knight"><span class="hs-identifier hs-var">Knight</span></a><span>
</span><a name="line-224"></a><span>    </span><span class="hs-number">13</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Queen"><span class="hs-identifier hs-var">Queen</span></a><span>
</span><a name="line-225"></a><span>    </span><span class="hs-number">14</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#King"><span class="hs-identifier hs-var">King</span></a><span>
</span><a name="line-226"></a><span>  </span><a name="local-8214565720323790776"><span class="hs-identifier">fromEnum</span></a><span> </span><a name="local-6989586621679093795"><a href="#local-6989586621679093795"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093795"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-227"></a><span>    </span><a href="DataTypes.html#Ace"><span class="hs-identifier hs-var">Ace</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-228"></a><span>    </span><a href="DataTypes.html#Two"><span class="hs-identifier hs-var">Two</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">2</span><span>
</span><a name="line-229"></a><span>    </span><a href="DataTypes.html#Three"><span class="hs-identifier hs-var">Three</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">3</span><span>
</span><a name="line-230"></a><span>    </span><a href="DataTypes.html#Four"><span class="hs-identifier hs-var">Four</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">4</span><span>
</span><a name="line-231"></a><span>    </span><a href="DataTypes.html#Five"><span class="hs-identifier hs-var">Five</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">5</span><span>
</span><a name="line-232"></a><span>    </span><a href="DataTypes.html#Six"><span class="hs-identifier hs-var">Six</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">6</span><span>
</span><a name="line-233"></a><span>    </span><a href="DataTypes.html#Seven"><span class="hs-identifier hs-var">Seven</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">7</span><span>
</span><a name="line-234"></a><span>    </span><a href="DataTypes.html#Eight"><span class="hs-identifier hs-var">Eight</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">8</span><span>
</span><a name="line-235"></a><span>    </span><a href="DataTypes.html#Nine"><span class="hs-identifier hs-var">Nine</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">9</span><span>
</span><a name="line-236"></a><span>    </span><a href="DataTypes.html#Ten"><span class="hs-identifier hs-var">Ten</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">10</span><span>
</span><a name="line-237"></a><span>    </span><a href="DataTypes.html#Jack"><span class="hs-identifier hs-var">Jack</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">11</span><span>
</span><a name="line-238"></a><span>    </span><a href="DataTypes.html#Knight"><span class="hs-identifier hs-var">Knight</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">12</span><span>
</span><a name="line-239"></a><span>    </span><a href="DataTypes.html#Queen"><span class="hs-identifier hs-var">Queen</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">13</span><span>
</span><a name="line-240"></a><span>    </span><a href="DataTypes.html#King"><span class="hs-identifier hs-var">King</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-number">14</span><span>
</span><a name="line-241"></a><span>  </span><a name="local-3458764513820541091"><span class="hs-identifier">enumFrom</span></a><span> </span><a name="local-6989586621679093796"><a href="#local-6989586621679093796"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093796"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">..</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span class="hs-glyph">::</span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span class="hs-special">)</span><span class="hs-special">]</span><span>
</span><a name="line-242"></a><span>
</span><a name="line-243"></a><span class="hs-identifier">next</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621679093804"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621679093804"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679093804"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><a href="#local-6989586621679093804"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093804"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-244"></a><a name="next"><a href="DataTypes.html#next"><span class="hs-identifier">next</span></a></a><span> </span><a name="local-6989586621679093805"><a href="#local-6989586621679093805"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679093805"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">minBound</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679093805"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-245"></a><span class="hs-identifier">prev</span><span> </span><span class="hs-glyph">::</span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621679093803"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621679093803"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679093803"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span>  </span><a href="#local-6989586621679093803"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093803"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-246"></a><a name="prev"><a href="DataTypes.html#prev"><span class="hs-identifier">prev</span></a></a><span> </span><a name="local-6989586621679093806"><a href="#local-6989586621679093806"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679093806"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><span class="hs-identifier hs-var">minBound</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">pred</span><span> </span><a href="#local-6989586621679093806"><span class="hs-identifier hs-var">a</span></a><span>
</span><a name="line-247"></a><span>
</span><a name="line-248"></a><span>
</span><a name="line-249"></a><span class="hs-keyword">instance</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Enum</span><span> </span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Bounded</span><span> </span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><span class="hs-identifier hs-type">Eq</span><span> </span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-identifier hs-type">Enum</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-250"></a><span>  </span><a name="local-8214565720323790777"><span class="hs-identifier">toEnum</span></a><span> </span><a name="local-6989586621679093287"><a href="#local-6989586621679093287"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679093288"><a href="#local-6989586621679093288"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093289"><a href="#local-6989586621679093289"><span class="hs-identifier">y</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093288"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093289"><span class="hs-identifier hs-var">y</span></a><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679093287"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">divMod</span><span class="hs-special">`</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- i `divMod` (fromEnum $ maxBound :: b)</span><span>
</span><a name="line-251"></a><span>  </span><a name="local-8214565720323790776"><span class="hs-identifier">fromEnum</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093791"><a href="#local-6989586621679093791"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093792"><a href="#local-6989586621679093792"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093791"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093285"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-special">(</span><span class="hs-number">1</span><span class="hs-operator hs-var">+</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-glyph">-</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093792"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="#local-6989586621679093286"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-252"></a><span>  </span><a name="local-3458764513820541091"><span class="hs-identifier">enumFrom</span></a><span> </span><a name="local-6989586621679093793"><a href="#local-6989586621679093793"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679093793"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679093793"><span class="hs-identifier hs-var">c</span></a><span class="hs-operator hs-var">==</span><span class="hs-identifier hs-var">maxBound</span><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-identifier hs-var">enumFrom</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">succ</span><span> </span><a href="#local-6989586621679093793"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-253"></a><span>
</span><a name="line-254"></a><span class="hs-identifier">suitChar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-255"></a><a name="suitChar"><a href="DataTypes.html#suitChar"><span class="hs-identifier">suitChar</span></a></a><span> </span><a name="local-6989586621679093807"><a href="#local-6989586621679093807"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679093807"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-256"></a><span>  </span><a href="DataTypes.html#Clubs"><span class="hs-identifier hs-var">Clubs</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'C'</span><span>
</span><a name="line-257"></a><span>  </span><a href="DataTypes.html#Diamonds"><span class="hs-identifier hs-var">Diamonds</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'D'</span><span>
</span><a name="line-258"></a><span>  </span><a href="DataTypes.html#Hearts"><span class="hs-identifier hs-var">Hearts</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'H'</span><span>
</span><a name="line-259"></a><span>  </span><a href="DataTypes.html#Spades"><span class="hs-identifier hs-var">Spades</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-char">'S'</span><span>
</span><a name="line-260"></a><span>
</span><a name="line-261"></a><span class="hs-comment">-- | Get the suit of a card.</span><span>
</span><a name="line-262"></a><span class="hs-identifier">suit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span>
</span><a name="line-263"></a><a name="suit"><a href="DataTypes.html#suit"><span class="hs-identifier">suit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">snd</span><span>
</span><a name="line-264"></a><span>
</span><a name="line-265"></a><span class="hs-comment">-- | Get the rank of a card.</span><span>
</span><a name="line-266"></a><span class="hs-identifier">rank</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span>
</span><a name="line-267"></a><a name="rank"><a href="DataTypes.html#rank"><span class="hs-identifier">rank</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fst</span><span>
</span><a name="line-268"></a><span>
</span><a name="line-269"></a><span class="hs-comment">-- | One character corresponding to the rank (A1..9TJCQK)</span><span>
</span><a name="line-270"></a><span class="hs-identifier">rankChar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-271"></a><a name="rankChar"><a href="DataTypes.html#rankChar"><span class="hs-identifier">rankChar</span></a></a><span> </span><a name="local-6989586621679093823"><a href="#local-6989586621679093823"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-char">'A'</span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679093824"><span class="hs-identifier hs-var">i</span></a><span> </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679093824"><a href="#local-6989586621679093824"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><span class="hs-number">2</span><span class="hs-glyph">..</span><span class="hs-number">9</span><span class="hs-special">]</span><span class="hs-glyph">::</span><span class="hs-special">[</span><span class="hs-identifier hs-type">Int</span><span class="hs-special">]</span><span> </span><span class="hs-special">]</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-char">'T'</span><span class="hs-special">,</span><span class="hs-char">'J'</span><span class="hs-special">,</span><span class="hs-char">'C'</span><span class="hs-special">,</span><span class="hs-char">'Q'</span><span class="hs-special">,</span><span class="hs-char">'K'</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-operator hs-var">!!</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093823"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-comment">-- UNSAFE</span><span>
</span><a name="line-272"></a><span>
</span><a name="line-273"></a><span class="hs-comment">-- | Get the unicode playing card character corresponding to some card</span><span>
</span><a name="line-274"></a><span class="hs-identifier">uniCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Char</span><span>
</span><a name="line-275"></a><a name="uniCard"><a href="DataTypes.html#uniCard"><span class="hs-identifier">uniCard</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679093995"><a href="#local-6989586621679093995"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679093996"><a href="#local-6989586621679093996"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-number">0x1F0A0</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">maxBound</span><span class="hs-glyph">::</span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">::</span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093996"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">*</span><span> </span><span class="hs-number">16</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679093995"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span>
</span><a name="line-276"></a><span>
</span><a name="line-277"></a><span class="hs-comment">--reading cards</span><span>
</span><a name="line-278"></a><span>
</span><a name="line-279"></a><span class="hs-keyword">type</span><span> </span><a name="Parser"><a href="DataTypes.html#Parser"><span class="hs-identifier">Parser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-type">StateT</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span>
</span><a name="line-280"></a><span class="hs-comment">-- | Given 2 parsers, tries the first, if it fails, try the second</span><span>
</span><a name="line-281"></a><span class="hs-special">(</span><span class="hs-operator">&lt;|&gt;</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="#local-6989586621679093802"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="#local-6989586621679093802"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="#local-6989586621679093802"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-282"></a><a name="local-6989586621679093997"><a href="#local-6989586621679093997"><span class="hs-identifier">a</span></a></a><span> </span><a name="%3C%7C%3E"><a href="DataTypes.html#%3C%7C%3E"><span class="hs-operator">&lt;|&gt;</span></a></a><span> </span><a name="local-6989586621679093998"><a href="#local-6989586621679093998"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679093999"><a href="#local-6989586621679093999"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679093997"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679093999"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-283"></a><span>    </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679094000"><a href="#local-6989586621679094000"><span class="hs-identifier">x</span></a></a><span class="hs-special">,</span><a name="local-6989586621679094001"><a href="#local-6989586621679094001"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679094000"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><a href="#local-6989586621679094001"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span>
</span><a name="line-284"></a><span>    </span><span class="hs-identifier hs-var">Nothing</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier">runStateT</span><span> </span><a href="#local-6989586621679093998"><span class="hs-identifier hs-var">b</span></a><span> </span><a href="#local-6989586621679093999"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-comment">--note that state is saved - Parsec does not do this for efficiency</span><span>
</span><a name="line-285"></a><span class="hs-identifier">runParser</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="#local-6989586621679093801"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679093801"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-286"></a><a name="runParser"><a href="DataTypes.html#runParser"><span class="hs-identifier">runParser</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">evalStateT</span><span>
</span><a name="line-287"></a><span>
</span><a name="line-288"></a><span>
</span><a name="line-289"></a><span class="hs-identifier">parseRank</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="DataTypes.html#Rank"><span class="hs-identifier hs-type">Rank</span></a><span>
</span><a name="line-290"></a><a name="parseRank"><a href="DataTypes.html#parseRank"><span class="hs-identifier">parseRank</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679094002"><a href="#local-6989586621679094002"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-291"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679094003"><a href="#local-6989586621679094003"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679094004"><a href="#local-6989586621679094004"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679094003"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679094004"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679094002"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-292"></a><span>    </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679095125"><a href="#local-6989586621679095125"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isPrefixOf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679095125"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679094002"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-293"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095615"><a href="#local-6989586621679095615"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095615"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679095615"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumFrom</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095616"><a href="#local-6989586621679095616"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095616"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-operator hs-var">.</span><a href="DataTypes.html#rankChar"><span class="hs-identifier hs-var">rankChar</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095616"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumFrom</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-294"></a><span>
</span><a name="line-295"></a><span class="hs-identifier">parseSuit</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="DataTypes.html#Suit"><span class="hs-identifier hs-type">Suit</span></a><span>
</span><a name="line-296"></a><a name="parseSuit"><a href="DataTypes.html#parseSuit"><span class="hs-identifier">parseSuit</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095617"><a href="#local-6989586621679095617"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-297"></a><span>  </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679095618"><a href="#local-6989586621679095618"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679095619"><a href="#local-6989586621679095619"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095618"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">drop</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">length</span><span> </span><a href="#local-6989586621679095619"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095617"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">listToMaybe</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-298"></a><span>    </span><span class="hs-identifier hs-var">filter</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679095620"><a href="#local-6989586621679095620"><span class="hs-identifier">c</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">isPrefixOf</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679095620"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-identifier hs-var">toLower</span><span> </span><a href="#local-6989586621679095617"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-299"></a><span>      </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095621"><a href="#local-6989586621679095621"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095621"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679095621"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumFrom</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095622"><a href="#local-6989586621679095622"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095622"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-glyph">:</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-operator hs-var">.</span><a href="DataTypes.html#suitChar"><span class="hs-identifier hs-var">suitChar</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095622"><span class="hs-identifier hs-var">x</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">enumFrom</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-300"></a><span>
</span><a name="line-301"></a><span class="hs-identifier">ignore</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">String</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span>
</span><a name="line-302"></a><a name="ignore"><a href="DataTypes.html#ignore"><span class="hs-identifier">ignore</span></a></a><span> </span><a name="local-6989586621679095623"><a href="#local-6989586621679095623"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">StateT</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095624"><a href="#local-6989586621679095624"><span class="hs-identifier">s'</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679095625"><a href="#local-6989586621679095625"><span class="hs-identifier">s''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span> </span><a href="#local-6989586621679095624"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-303"></a><span>                            </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679095626"><a href="#local-6989586621679095626"><span class="hs-identifier">s'''</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">stripPrefix</span><span> </span><a href="#local-6989586621679095623"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679095625"><span class="hs-identifier hs-var">s''</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-304"></a><span>                              </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">dropWhile</span><span> </span><span class="hs-identifier hs-var">isSpace</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095626"><span class="hs-identifier hs-var">s'''</span></a><span class="hs-special">)</span><span>
</span><a name="line-305"></a><span>
</span><a name="line-306"></a><span class="hs-identifier">parseCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Parser"><span class="hs-identifier hs-type">Parser</span></a><span> </span><a href="DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span>
</span><a name="line-307"></a><a name="parseCard"><a href="DataTypes.html#parseCard"><span class="hs-identifier">parseCard</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">do</span><span>
</span><a name="line-308"></a><span>  </span><a name="local-6989586621679095627"><a href="#local-6989586621679095627"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataTypes.html#parseRank"><span class="hs-identifier hs-var">parseRank</span></a><span>
</span><a name="line-309"></a><span>  </span><a href="DataTypes.html#ignore"><span class="hs-identifier hs-var">ignore</span></a><span> </span><span class="hs-string">&quot;of&quot;</span><span> </span><span class="hs-comment">-- and possibly spaces either side</span><span>
</span><a name="line-310"></a><span>  </span><a name="local-6989586621679095628"><a href="#local-6989586621679095628"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="DataTypes.html#parseSuit"><span class="hs-identifier hs-var">parseSuit</span></a><span>
</span><a name="line-311"></a><span>  </span><span class="hs-identifier hs-var">return</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095627"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="#local-6989586621679095628"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-312"></a><span>
</span><a name="line-313"></a><span>
</span><a name="line-314"></a><span class="hs-comment">-- | Get the player of an event</span><span>
</span><a name="line-315"></a><span class="hs-identifier">eventPlayer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span>
</span><a name="line-316"></a><a name="eventPlayer"><a href="DataTypes.html#eventPlayer"><span class="hs-identifier">eventPlayer</span></a></a><span> </span><span class="hs-special">(</span><a href="DataTypes.html#Action"><span class="hs-identifier hs-var">Action</span></a><span> </span><a name="local-6989586621679095629"><a href="#local-6989586621679095629"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679095629"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-317"></a><span class="hs-identifier">eventPlayer</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#PlayerJoin"><span class="hs-identifier hs-var">PlayerJoin</span></a><span> </span><a name="local-6989586621679095630"><a href="#local-6989586621679095630"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679095630"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-318"></a><span class="hs-identifier">eventPlayer</span><span> </span><a href="DataTypes.html#Timeout"><span class="hs-identifier hs-var">Timeout</span></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-319"></a><span>
</span><a name="line-320"></a><span class="hs-comment">-- | variable processing</span><span>
</span><a name="line-321"></a><span>
</span><a name="line-322"></a><span class="hs-identifier">readVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#VarName"><span class="hs-identifier hs-type">VarName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span>
</span><a name="line-323"></a><a name="readVar"><a href="DataTypes.html#readVar"><span class="hs-identifier">readVar</span></a></a><span> </span><a name="local-6989586621679095631"><a href="#local-6989586621679095631"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679095632"><a href="#local-6989586621679095632"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.findWithDefault</span><span> </span><span class="hs-number">0</span><span> </span><a href="#local-6989586621679095631"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095632"><span class="hs-identifier hs-var">gs</span></a><span class="hs-operator hs-var">^.</span><a href="DataTypes.html#varMap"><span class="hs-identifier hs-var">varMap</span></a><span class="hs-special">)</span><span>
</span><a name="line-324"></a><span>
</span><a name="line-325"></a><span class="hs-identifier">setVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#VarName"><span class="hs-identifier hs-type">VarName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span>
</span><a name="line-326"></a><a name="setVar"><a href="DataTypes.html#setVar"><span class="hs-identifier">setVar</span></a></a><span> </span><a name="local-6989586621679095667"><a href="#local-6989586621679095667"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679095668"><a href="#local-6989586621679095668"><span class="hs-identifier">i</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#varMap"><span class="hs-identifier hs-var">varMap</span></a><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-identifier hs-var">Map.insert</span><span> </span><a href="#local-6989586621679095667"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679095668"><span class="hs-identifier hs-var">i</span></a><span>
</span><a name="line-327"></a><span>
</span><a name="line-328"></a><span class="hs-identifier">modifyVar</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#VarName"><span class="hs-identifier hs-type">VarName</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Int</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span>
</span><a name="line-329"></a><a name="modifyVar"><a href="DataTypes.html#modifyVar"><span class="hs-identifier">modifyVar</span></a></a><span> </span><a name="local-6989586621679095749"><a href="#local-6989586621679095749"><span class="hs-identifier">s</span></a></a><span> </span><a name="local-6989586621679095750"><a href="#local-6989586621679095750"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679095751"><a href="#local-6989586621679095751"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><a href="#local-6989586621679095749"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095750"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="DataTypes.html#readVar"><span class="hs-identifier hs-var">readVar</span></a><span> </span><a href="#local-6989586621679095749"><span class="hs-identifier hs-var">s</span></a><span> </span><a href="#local-6989586621679095751"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095751"><span class="hs-identifier hs-var">gs</span></a><span>
</span><a name="line-330"></a><span>
</span><a name="line-331"></a><span>
</span><a name="line-332"></a><span class="hs-comment">-- | Shuffle the deck (does not touch the pile or hands) using the random seed contained in GameState.</span><span>
</span><a name="line-333"></a><span class="hs-identifier">shuffleDeck</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span>
</span><a name="line-334"></a><a name="shuffleDeck"><a href="DataTypes.html#shuffleDeck"><span class="hs-identifier">shuffleDeck</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">uncurry</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="DataTypes.html#deck"><span class="hs-identifier hs-var">deck</span></a><span class="hs-operator hs-var">%~</span><span class="hs-special">)</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ap</span><span> </span><span class="hs-identifier hs-var">shuffle'</span><span> </span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#randg"><span class="hs-identifier hs-var">randg</span></a><span> </span><span class="hs-operator hs-var">%%~</span><span> </span><span class="hs-identifier hs-var">split</span><span class="hs-special">)</span><span>
</span><a name="line-335"></a><span class="hs-comment">-- shuffleDeck = (deck /\ randg) %~ ap ((`ap` snd) . ((,) .) . (. fst) . liftM2 shuffle' fst (length . fst)) (split . snd)</span><span>
</span><a name="line-336"></a><span class="hs-comment">-- shuffleDeck = (deck /\ randg) %~ (\(d,r) -&gt; let (r1,r2) = split r in (shuffle' d (length d) r1,r2))</span><span>
</span><a name="line-337"></a><span>
</span><a name="line-338"></a><span class="hs-comment">-- | Construct a new game from a list of player names.</span><span>
</span><a name="line-339"></a><span class="hs-identifier">newGame</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-type">String</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span>
</span><a name="line-340"></a><a name="newGame"><a href="DataTypes.html#newGame"><span class="hs-identifier">newGame</span></a></a><span> </span><a name="local-6989586621679095862"><a href="#local-6989586621679095862"><span class="hs-identifier">pls</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="DataTypes.html#pile"><span class="hs-identifier hs-var">pile</span></a><span> </span><a href="DataTypes.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a><span> </span><a href="DataTypes.html#deck"><span class="hs-identifier hs-var">deck</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679095863"><a href="#local-6989586621679095863"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679095864"><a href="#local-6989586621679095864"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095863"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">:|</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679095864"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="DataTypes.html#shuffleDeck"><span class="hs-identifier hs-var">shuffleDeck</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-comment">-- UNSAFE</span><span>
</span><a name="line-341"></a><span>           </span><a href="DataTypes.html#GS"><span class="hs-identifier hs-var">GS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_deck</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-342"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_pile</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-343"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_messages</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-344"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_lastMoveLegal</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-345"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_randg</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">mkStdGen</span><span> </span><span class="hs-number">0</span><span>
</span><a name="line-346"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_varMap</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-347"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_players</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095862"><span class="hs-identifier hs-var">pls</span></a><span>  </span><span class="hs-comment">--[(&quot;Angus&quot;,[]),(&quot;Toby&quot;,[]),(&quot;Anne&quot;,[])]</span><span>
</span><a name="line-348"></a><span>              </span><span class="hs-comment">-- , _seats = pls</span><span>
</span><a name="line-349"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_hands</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.fromList</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">flip</span><span> </span><span class="hs-special">(</span><span class="hs-special">,</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095862"><span class="hs-identifier hs-var">pls</span></a><span class="hs-special">)</span><span>
</span><a name="line-350"></a><span>              </span><span class="hs-comment">--, _prevGS = Nothing</span><span>
</span><a name="line-351"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_winner</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-352"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-353"></a><span>
</span><a name="line-354"></a><span class="hs-comment">-- | Make a new game with no players given a seeded rng</span><span>
</span><a name="line-355"></a><span class="hs-identifier">randGame</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">StdGen</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span>
</span><a name="line-356"></a><a name="randGame"><a href="DataTypes.html#randGame"><span class="hs-identifier">randGame</span></a></a><span> </span><a name="local-6989586621679095865"><a href="#local-6989586621679095865"><span class="hs-identifier">rng</span></a></a><span> </span><span class="hs-glyph">=</span><span>  </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="DataTypes.html#pile"><span class="hs-identifier hs-var">pile</span></a><span> </span><a href="DataTypes.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a><span> </span><a href="DataTypes.html#deck"><span class="hs-identifier hs-var">deck</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">%~</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679095866"><a href="#local-6989586621679095866"><span class="hs-identifier">y</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679095867"><a href="#local-6989586621679095867"><span class="hs-identifier">ys</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095866"><span class="hs-identifier hs-var">y</span></a><span class="hs-operator hs-var">:|</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><a href="#local-6989586621679095867"><span class="hs-identifier hs-var">ys</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="DataTypes.html#shuffleDeck"><span class="hs-identifier hs-var">shuffleDeck</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-comment">-- UNSAFE</span><span>
</span><a name="line-357"></a><span>           </span><a href="DataTypes.html#GS"><span class="hs-identifier hs-var">GS</span></a><span> </span><span class="hs-special">{</span><span> </span><span class="hs-identifier">_deck</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span> </span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">..</span><span> </span><span class="hs-special">]</span><span>
</span><a name="line-358"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_pile</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-359"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_messages</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>
</span><a name="line-360"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_lastMoveLegal</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-361"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_randg</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095865"><span class="hs-identifier hs-var">rng</span></a><span>
</span><a name="line-362"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_varMap</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-363"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_players</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span>  </span><span class="hs-comment">--[(&quot;Angus&quot;,[]),(&quot;Toby&quot;,[]),(&quot;Anne&quot;,[])]</span><span>
</span><a name="line-364"></a><span>              </span><span class="hs-comment">-- , _seats = pls</span><span>
</span><a name="line-365"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_hands</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.empty</span><span>
</span><a name="line-366"></a><span>              </span><span class="hs-comment">--, _prevGS = Nothing</span><span>
</span><a name="line-367"></a><span>              </span><span class="hs-special">,</span><span> </span><span class="hs-identifier">_winner</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-368"></a><span>              </span><span class="hs-special">}</span><span>
</span><a name="line-369"></a><span>
</span><a name="line-370"></a><span class="hs-comment">-- Thanks stack overflow</span><span>
</span><a name="line-371"></a><span class="hs-special">(</span><span class="hs-operator">/\</span><span class="hs-special">)</span><span>
</span><a name="line-372"></a><span>    </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Functor</span><span> </span><a href="#local-6989586621679093797"><span class="hs-identifier hs-type">f</span></a><span class="hs-special">)</span><span>
</span><a name="line-373"></a><span>    </span><span class="hs-glyph">=&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-374"></a><span>    </span><span class="hs-comment">-- ^ Lens' c a</span><span>
</span><a name="line-375"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-376"></a><span>    </span><span class="hs-comment">-- ^ Lens' c b</span><span>
</span><a name="line-377"></a><span>    </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093797"><span class="hs-identifier hs-type">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093798"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679093800"><span class="hs-identifier hs-type">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679093797"><span class="hs-identifier hs-type">f</span></a><span> </span><a href="#local-6989586621679093799"><span class="hs-identifier hs-type">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-378"></a><span>    </span><span class="hs-comment">-- ^ Lens' c (a, b)</span><span>
</span><a name="line-379"></a><span class="hs-special">(</span><a name="local-6989586621679095868"><a href="#local-6989586621679095868"><span class="hs-identifier">lens1</span></a></a><span> </span><a name="%2F%5C"><a href="DataTypes.html#%2F%5C"><span class="hs-operator">/\</span></a></a><span> </span><a name="local-6989586621679095869"><a href="#local-6989586621679095869"><span class="hs-identifier">lens2</span></a></a><span class="hs-special">)</span><span> </span><a name="local-6989586621679095870"><a href="#local-6989586621679095870"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679095871"><a href="#local-6989586621679095871"><span class="hs-identifier">c0</span></a></a><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-380"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679095872"><a href="#local-6989586621679095872"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095868"><span class="hs-identifier hs-var">lens1</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095875"><a href="#local-6989586621679095875"><span class="hs-identifier">a_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095875"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095875"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095871"><span class="hs-identifier hs-var">c0</span></a><span>
</span><a name="line-381"></a><span>        </span><span class="hs-special">(</span><a name="local-6989586621679095873"><a href="#local-6989586621679095873"><span class="hs-identifier">b</span></a></a><span class="hs-special">,</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095869"><span class="hs-identifier hs-var">lens2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095876"><a href="#local-6989586621679095876"><span class="hs-identifier">b_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095876"><span class="hs-identifier hs-var">b_</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095876"><span class="hs-identifier hs-var">b_</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095871"><span class="hs-identifier hs-var">c0</span></a><span>
</span><a name="line-382"></a><span>        </span><a name="local-6989586621679095874"><a href="#local-6989586621679095874"><span class="hs-identifier">fab</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095870"><span class="hs-identifier hs-var">f</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095872"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095873"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-383"></a><span>    </span><span class="hs-keyword">in</span><span> </span><span class="hs-identifier hs-var">fmap</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679095877"><a href="#local-6989586621679095877"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679095878"><a href="#local-6989586621679095878"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-384"></a><span>            </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679095879"><a href="#local-6989586621679095879"><span class="hs-identifier">c1</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095868"><span class="hs-identifier hs-var">lens1</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095881"><a href="#local-6989586621679095881"><span class="hs-identifier">a_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095881"><span class="hs-identifier hs-var">a_</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095877"><span class="hs-identifier hs-var">a</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095871"><span class="hs-identifier hs-var">c0</span></a><span>
</span><a name="line-385"></a><span>                </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><span> </span><a name="local-6989586621679095880"><a href="#local-6989586621679095880"><span class="hs-identifier">c2</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679095869"><span class="hs-identifier hs-var">lens2</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679095882"><a href="#local-6989586621679095882"><span class="hs-identifier">b_</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679095882"><span class="hs-identifier hs-var">b_</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679095878"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095879"><span class="hs-identifier hs-var">c1</span></a><span>
</span><a name="line-386"></a><span>            </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679095880"><span class="hs-identifier hs-var">c2</span></a><span>
</span><a name="line-387"></a><span>            </span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679095874"><span class="hs-identifier hs-var">fab</span></a><span>
</span><a name="line-388"></a><span>
</span><a name="line-389"></a><span class="hs-keyword">infixl</span><span> </span><span class="hs-number">7</span><span> </span><a href="DataTypes.html#%2F%5C"><span class="hs-operator hs-var">/\</span></a><span>
</span><a name="line-390"></a></pre></body></html>