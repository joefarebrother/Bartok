<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-pragma">{-# LANGUAGE Safe #-}</span><span>
</span><a name="line-2"></a><span class="hs-comment">{-|
Module      : Views
Description : How the game decides what to send to the client

The functions in this module define how the data sent to clients is constructed.
They should help when writing rules that affect what players can see.
-}</span><span>
</span><a name="line-9"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Views</span><span class="hs-special">(</span><span class="hs-comment">-- * Type Synonyms</span><span>
</span><a name="line-10"></a><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span class="hs-special">,</span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span class="hs-special">,</span><span>
</span><a name="line-11"></a><span class="hs-comment">-- * Basic Rules</span><span>
</span><a name="line-12"></a><a href="Views.html#baseViewer"><span class="hs-identifier hs-var">baseViewer</span></a><span class="hs-special">,</span><a href="DataTypes.html#GameView"><span class="hs-identifier hs-type">GameView</span></a><span class="hs-special">(</span><span class="hs-glyph">..</span><span class="hs-special">)</span><span class="hs-special">,</span><span>
</span><a name="line-13"></a><span class="hs-comment">-- *</span><span>
</span><a name="line-14"></a><a href="Views.html#lastCard"><span class="hs-identifier hs-var">lastCard</span></a><span class="hs-special">,</span><a href="Views.html#onlyOwnCards"><span class="hs-identifier hs-var">onlyOwnCards</span></a><span class="hs-special">,</span><span>
</span><a name="line-15"></a><a href="Views.html#defaultView"><span class="hs-identifier hs-var">defaultView</span></a><span class="hs-special">,</span><span>
</span><a name="line-16"></a><span class="hs-comment">-- * Helper functions</span><span>
</span><a name="line-17"></a><a href="Views.html#makeViewTransformer"><span class="hs-identifier hs-var">makeViewTransformer</span></a><span class="hs-special">,</span><span>
</span><a name="line-18"></a><span class="hs-comment">-- ** dealing with hands</span><span>
</span><a name="line-19"></a><a href="Views.html#mapOwnHand"><span class="hs-identifier hs-var">mapOwnHand</span></a><span class="hs-special">,</span><a href="Views.html#mapOtherHands"><span class="hs-identifier hs-var">mapOtherHands</span></a><span class="hs-special">,</span><span> </span><a href="Views.html#modifyHandMap"><span class="hs-identifier hs-var">modifyHandMap</span></a><span class="hs-special">,</span><span> </span><a href="Views.html#mapHands"><span class="hs-identifier hs-var">mapHands</span></a><span class="hs-special">,</span><span>
</span><a name="line-20"></a><a href="Views.html#hideHand"><span class="hs-identifier hs-var">hideHand</span></a><span class="hs-special">,</span><span>
</span><a name="line-21"></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-22"></a><span>
</span><a name="line-23"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Arrow</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span class="hs-special">)</span><span>
</span><a name="line-24"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Lens</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">%~</span><span class="hs-special">)</span><span class="hs-special">,</span><span class="hs-special">(</span><span class="hs-operator hs-var">^.</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-25"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Control.Monad</span><span>
</span><a name="line-26"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span> </span><span class="hs-comment">--(adjust,assocs,findWithDefault,map,mapWithKey)</span><span>
</span><a name="line-27"></a><span class="hs-comment">--import Data.Map (Map)</span><span>
</span><a name="line-28"></a><span class="hs-keyword">import</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">NonEmpty</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">:|</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-keyword">import</span><span> </span><a href="DataTypes.html"><span class="hs-identifier">DataTypes</span></a><span> </span><span class="hs-keyword">hiding</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#_hands"><span class="hs-identifier hs-var">_hands</span></a><span class="hs-special">,</span><a href="DataTypes.html#_pile"><span class="hs-identifier hs-var">_pile</span></a><span class="hs-special">,</span><a href="DataTypes.html#_deck"><span class="hs-identifier hs-var">_deck</span></a><span class="hs-special">,</span><a href="DataTypes.html#_messages"><span class="hs-identifier hs-var">_messages</span></a><span class="hs-special">)</span><span>
</span><a name="line-31"></a><span>
</span><a name="line-32"></a><span class="hs-comment">-- | Turn a function transforming a 'GameView' into a viewRule</span><span>
</span><a name="line-33"></a><span class="hs-comment">-- &gt; makeViewTransformer f r p gs == f$ r p gs</span><span>
</span><a name="line-34"></a><span class="hs-identifier">makeViewTransformer</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#GameView"><span class="hs-identifier hs-type">GameView</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#GameView"><span class="hs-identifier hs-type">GameView</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-35"></a><a name="makeViewTransformer"><a href="Views.html#makeViewTransformer"><span class="hs-identifier">makeViewTransformer</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">.</span><span class="hs-special">)</span><span>
</span><a name="line-36"></a><span class="hs-comment">--makeViewTransformer f r p gs = f$ r p gs</span><span>
</span><a name="line-37"></a><span>
</span><a name="line-38"></a><span>
</span><a name="line-39"></a><span class="hs-comment">-- | Apply a modification to the structure describing what can be seen of each player's hand after inner rules have been applied.</span><span>
</span><a name="line-40"></a><span class="hs-identifier">modifyHandMap</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">(</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-special">(</span><a href="DataTypes.html#Name"><span class="hs-identifier hs-type">Name</span></a><span class="hs-special">,</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-41"></a><a name="modifyHandMap"><a href="Views.html#modifyHandMap"><span class="hs-identifier">modifyHandMap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#makeViewTransformer"><span class="hs-identifier hs-var">makeViewTransformer</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="DataTypes.html#handsV"><span class="hs-identifier hs-var">handsV</span></a><span> </span><span class="hs-operator hs-var">%~</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- | Apply a function to all views of hands</span><span>
</span><a name="line-45"></a><span class="hs-identifier">mapHands</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-46"></a><a name="mapHands"><a href="Views.html#mapHands"><span class="hs-identifier">mapHands</span></a></a><span> </span><a name="local-6989586621679131905"><a href="#local-6989586621679131905"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#modifyHandMap"><span class="hs-identifier hs-var">modifyHandMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><a href="#local-6989586621679131905"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-47"></a><span class="hs-comment">--mapHands f = modifyHandMap (Map.map f)</span><span>
</span><a name="line-48"></a><span>
</span><a name="line-49"></a><span class="hs-comment">-- Modify the view of a particular player's hand</span><span>
</span><a name="line-50"></a><span class="hs-comment">-- mapOwnHand :: Name -&gt; ([CardView]-&gt;[CardView]) -&gt; ViewRule</span><span>
</span><a name="line-51"></a><span class="hs-comment">-- mapOwnHand p f = modifyHandMap (map (join (ap (if'.(p==).fst) (second f)))) -- (\l -&gt; [if x == p then (x,f y) else (x,y) | (x,y) &lt;- l])</span><span>
</span><a name="line-52"></a><span class="hs-comment">--mapOwnHand p f = modifyHandMap (Map.adjust f p)</span><span>
</span><a name="line-53"></a><span>
</span><a name="line-54"></a><span class="hs-comment">-- | Modify a player's view of their own hand</span><span>
</span><a name="line-55"></a><span class="hs-identifier">mapOwnHand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-56"></a><span class="hs-comment">--mapOwnHand f r p = modifyHandMap (map (join (ap (if'.(p==).fst) (second f)))) r p</span><span>
</span><a name="line-57"></a><a name="mapOwnHand"><a href="Views.html#mapOwnHand"><span class="hs-identifier">mapOwnHand</span></a></a><span> </span><a name="local-6989586621679131906"><a href="#local-6989586621679131906"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679131907"><a href="#local-6989586621679131907"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679131908"><a href="#local-6989586621679131908"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#modifyHandMap"><span class="hs-identifier hs-var">modifyHandMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679131909"><a href="#local-6989586621679131909"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679131910"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679131908"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131910"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">,</span><a href="#local-6989586621679131906"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679131911"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131910"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">,</span><a href="#local-6989586621679131911"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679131910"><a href="#local-6989586621679131910"><span class="hs-identifier">p'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679131911"><a href="#local-6989586621679131911"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679131909"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679131907"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679131908"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-58"></a><span>
</span><a name="line-59"></a><span class="hs-comment">-- Modify the view of all player's hands</span><span>
</span><a name="line-60"></a><span class="hs-comment">-- mapOtherHands :: Name -&gt; ([CardView]-&gt;[CardView]) -&gt; ViewRule</span><span>
</span><a name="line-61"></a><span class="hs-comment">-- mapOtherHands p f = modifyHandMap (map (join (ap (if'.(p/=).fst) (second f))))</span><span>
</span><a name="line-62"></a><span>
</span><a name="line-63"></a><span class="hs-comment">-- | Modify the view of all other players' hands</span><span>
</span><a name="line-64"></a><span class="hs-identifier">mapOtherHands</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-65"></a><span class="hs-comment">--mapOtherHands f r p = modifyHandMap (map (join (ap (if'.(p/=).fst) (second f)))) r p</span><span>
</span><a name="line-66"></a><a name="mapOtherHands"><a href="Views.html#mapOtherHands"><span class="hs-identifier">mapOtherHands</span></a></a><span> </span><a name="local-6989586621679131912"><a href="#local-6989586621679131912"><span class="hs-identifier">f</span></a></a><span> </span><a name="local-6989586621679131913"><a href="#local-6989586621679131913"><span class="hs-identifier">r</span></a></a><span> </span><a name="local-6989586621679131914"><a href="#local-6989586621679131914"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#modifyHandMap"><span class="hs-identifier hs-var">modifyHandMap</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679131915"><a href="#local-6989586621679131915"><span class="hs-identifier">l</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679131916"><span class="hs-identifier hs-var">p'</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679131914"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131916"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">,</span><a href="#local-6989586621679131912"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679131917"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131916"><span class="hs-identifier hs-var">p'</span></a><span class="hs-special">,</span><a href="#local-6989586621679131917"><span class="hs-identifier hs-var">h</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679131916"><a href="#local-6989586621679131916"><span class="hs-identifier">p'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679131917"><a href="#local-6989586621679131917"><span class="hs-identifier">h</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">&lt;-</span><span> </span><a href="#local-6989586621679131915"><span class="hs-identifier hs-var">l</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679131913"><span class="hs-identifier hs-var">r</span></a><span> </span><a href="#local-6989586621679131914"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-67"></a><span class="hs-comment">-- | Like 'baseGame', this defines how cards should be viewed in a very simple game. See 'DataTypes.GameView' for more.</span><span>
</span><a name="line-68"></a><span class="hs-identifier">baseViewer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span>
</span><a name="line-69"></a><a name="baseViewer"><a href="Views.html#baseViewer"><span class="hs-identifier">baseViewer</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679131918"><a href="#local-6989586621679131918"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="DataTypes.html#GV"><span class="hs-identifier hs-var">GV</span></a><span> </span><span class="hs-special">{</span><span>
</span><a name="line-70"></a><span>    </span><span class="hs-identifier">_handsV</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-comment">-- uncurry (++) -- turn the tuple back into a list</span><span>
</span><a name="line-71"></a><span>              </span><span class="hs-comment">-- . (map (second (liftM3 if' ((&gt;1).length) (map CardFace) (map (const CardBack))))</span><span>
</span><a name="line-72"></a><span>              </span><span class="hs-comment">--      *** (map (second (map (const CardBack))) . takeWhile ((/=p).fst)))</span><span>
</span><a name="line-73"></a><span>              </span><span class="hs-comment">-- . splitAt 1 -- treat the viewer's hand separately (they can see their own hand if not last card)</span><span>
</span><a name="line-74"></a><span>                </span><span class="hs-comment">-- liftM2 (:) head (takeWhile ((/=p).fst)) . dropWhile ((/=p).fst) . cycle -- starting with the viewer</span><span>
</span><a name="line-75"></a><span>                </span><span class="hs-comment">-- uncurry (flip (++)) . span ((/=p).fst) -- put p to the front</span><span>
</span><a name="line-76"></a><span>                </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">second</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><a href="DataTypes.html#CardFace"><span class="hs-identifier hs-var">CardFace</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Map.assocs</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679131918"><span class="hs-identifier hs-var">gs</span></a><span class="hs-operator hs-var">^.</span><a href="DataTypes.html#hands"><span class="hs-identifier hs-var">hands</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-77"></a><span>    </span><span class="hs-identifier">_pileV</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679131919"><a href="#local-6989586621679131919"><span class="hs-identifier">c</span></a></a><span class="hs-operator hs-var">:|</span><a name="local-6989586621679131920"><a href="#local-6989586621679131920"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="DataTypes.html#CardFace"><span class="hs-identifier hs-var">CardFace</span></a><span> </span><a href="#local-6989586621679131919"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="DataTypes.html#CardBack"><span class="hs-identifier hs-var">CardBack</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679131920"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131918"><span class="hs-identifier hs-var">gs</span></a><span class="hs-operator hs-var">^.</span><a href="DataTypes.html#pile"><span class="hs-identifier hs-var">pile</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-78"></a><span>    </span><span class="hs-identifier">_deckV</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="DataTypes.html#CardBack"><span class="hs-identifier hs-var">CardBack</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679131918"><span class="hs-identifier hs-var">gs</span></a><span class="hs-operator hs-var">^.</span><a href="DataTypes.html#deck"><span class="hs-identifier hs-var">deck</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">,</span><span>
</span><a name="line-79"></a><span>    </span><span class="hs-identifier">_messagesV</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679131918"><span class="hs-identifier hs-var">gs</span></a><span class="hs-operator hs-var">^.</span><a href="DataTypes.html#messages"><span class="hs-identifier hs-var">messages</span></a><span> </span><span class="hs-special">}</span><span>
</span><a name="line-80"></a><span>
</span><a name="line-81"></a><span class="hs-identifier">hideHand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="DataTypes.html#CardView"><span class="hs-identifier hs-type">CardView</span></a><span class="hs-special">]</span><span>
</span><a name="line-82"></a><a name="hideHand"><a href="Views.html#hideHand"><span class="hs-identifier">hideHand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">map</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><a href="DataTypes.html#CardBack"><span class="hs-identifier hs-var">CardBack</span></a><span class="hs-special">)</span><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- | Hides other players' hands.</span><span>
</span><a name="line-85"></a><span class="hs-identifier">onlyOwnCards</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-86"></a><a name="onlyOwnCards"><a href="Views.html#onlyOwnCards"><span class="hs-identifier">onlyOwnCards</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#mapOtherHands"><span class="hs-identifier hs-var">mapOtherHands</span></a><span> </span><a href="Views.html#hideHand"><span class="hs-identifier hs-var">hideHand</span></a><span>
</span><a name="line-87"></a><span>
</span><a name="line-88"></a><span class="hs-comment">-- | Hide the last card in a player's hand.</span><span>
</span><a name="line-89"></a><span class="hs-identifier">lastCard</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-90"></a><a name="lastCard"><a href="Views.html#lastCard"><span class="hs-identifier">lastCard</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#mapOwnHand"><span class="hs-identifier hs-var">mapOwnHand</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">ap</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="DataTypes.html#if%27"><span class="hs-identifier hs-var">if'</span></a><span> </span><span class="hs-operator hs-var">=&lt;&lt;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-operator hs-var">.</span><span class="hs-identifier hs-var">length</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Views.html#hideHand"><span class="hs-identifier hs-var">hideHand</span></a><span class="hs-special">)</span><span>
</span><a name="line-91"></a><span class="hs-comment">-- lastCard = (,) id (((handsV.each._2 %~</span><span>
</span><a name="line-92"></a><span class="hs-comment">--                ap ((if' =&lt;&lt;) ((&gt;1).length)) (map (const CardBack))).).)</span><span>
</span><a name="line-93"></a><span>
</span><a name="line-94"></a><span class="hs-comment">-- | 'baseView' with the above rules added to it.</span><span>
</span><a name="line-95"></a><span class="hs-identifier">defaultView</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="DataTypes.html#Viewer"><span class="hs-identifier hs-type">Viewer</span></a><span>
</span><a name="line-96"></a><a name="defaultView"><a href="Views.html#defaultView"><span class="hs-identifier">defaultView</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Views.html#lastCard"><span class="hs-identifier hs-var">lastCard</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Views.html#onlyOwnCards"><span class="hs-identifier hs-var">onlyOwnCards</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Views.html#baseViewer"><span class="hs-identifier hs-var">baseViewer</span></a><span>
</span><a name="line-97"></a></pre></body></html>