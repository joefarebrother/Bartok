<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd"><html xmlns="http://www.w3.org/1999/xhtml"><head><link rel="stylesheet" type="text/css" href="style.css" /><script type="text/javascript" src="highlight.js"></script></head><body><pre><span class="hs-comment">{-|
Module      : TSample
Description : Sample rules using Tlib.

Looking at the source code is recommended
-}</span><span>
</span><a name="line-7"></a><span class="hs-keyword">module</span><span> </span><span class="hs-identifier">Game.Bartok.TSample</span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#r7"><span class="hs-identifier hs-var">r7</span></a><span class="hs-special">,</span><a href="Game.Bartok.TSample.html#r8"><span class="hs-identifier hs-var">r8</span></a><span class="hs-special">,</span><a href="Game.Bartok.TSample.html#rq"><span class="hs-identifier hs-var">rq</span></a><span class="hs-special">,</span><a href="Game.Bartok.TSample.html#rSpade"><span class="hs-identifier hs-var">rSpade</span></a><span class="hs-special">,</span><a href="Game.Bartok.TSample.html#rNoHTML"><span class="hs-identifier hs-var">rNoHTML</span></a><span class="hs-special">)</span><span>
</span><a name="line-8"></a><span> </span><span class="hs-keyword">where</span><span>
</span><a name="line-9"></a><span class="hs-keyword">import</span><span> </span><a href="Game.Bartok.TLib.html"><span class="hs-identifier">Game.Bartok.TLib</span></a><span>
</span><a name="line-10"></a><span class="hs-keyword">import</span><span> </span><a href="Game.Bartok.Views.html"><span class="hs-identifier">Game.Bartok.Views</span></a><span class="hs-special">(</span><a href="Game.Bartok.Views.html#mapHands"><span class="hs-identifier hs-var">mapHands</span></a><span class="hs-special">)</span><span>
</span><a name="line-11"></a><span class="hs-keyword">import</span><span> </span><a href="Game.Bartok.DataTypes.html"><span class="hs-identifier">Game.Bartok.DataTypes</span></a><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#_deck"><span class="hs-identifier hs-var">_deck</span></a><span class="hs-special">,</span><span> </span><a href="Game.Bartok.DataTypes.html#shuffleDeck"><span class="hs-identifier hs-var">shuffleDeck</span></a><span class="hs-special">,</span><span> </span><a href="Game.Bartok.DataTypes.html#_pile"><span class="hs-identifier hs-var">_pile</span></a><span class="hs-special">,</span><span> </span><a href="Game.Bartok.DataTypes.html#_players"><span class="hs-identifier hs-var">_players</span></a><span class="hs-special">,</span><span> </span><a href="Game.Bartok.DataTypes.html#_hands"><span class="hs-identifier hs-var">_hands</span></a><span class="hs-special">)</span><span>
</span><a name="line-12"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.List.NonEmpty</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">NE</span><span>
</span><a name="line-13"></a><span class="hs-keyword">import</span><span> </span><span class="hs-keyword">qualified</span><span> </span><span class="hs-identifier">Data.Map</span><span> </span><span class="hs-keyword">as</span><span> </span><span class="hs-identifier">Map</span><span>
</span><a name="line-14"></a><span>
</span><a name="line-15"></a><span class="hs-comment">{-
Note that when submitting a rule, the game server expects an expression.
To allow definitions and type signatures, use @let@ e.g.

&gt; let r8 :: rule
&gt;     r8 = when (isLegal ~&amp;~ cardIs ((==Eight) . rank)) (doAfter nextTurn)
&gt;   in r8

(also remember to tick Tlib and untick RuleHelpers)
-}</span><span>
</span><a name="line-25"></a><span>
</span><a name="line-26"></a><span class="hs-comment">-- When a card is legal and is an eight, then skip a player.</span><span>
</span><a name="line-27"></a><span class="hs-identifier">r8</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-28"></a><a name="r8"><a href="Game.Bartok.TSample.html#r8"><span class="hs-identifier">r8</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="Game.Bartok.DataTypes.html#Eight"><span class="hs-identifier hs-var">Eight</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><a href="Game.Bartok.BaseGame.html#nextTurn"><span class="hs-identifier hs-var">nextTurn</span></a><span class="hs-special">)</span><span>
</span><a name="line-29"></a><span>
</span><a name="line-30"></a><span class="hs-identifier">reverseDirection</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.DataTypes.html#GameState"><span class="hs-identifier hs-type">GameState</span></a><span>
</span><a name="line-31"></a><a name="reverseDirection"><a href="Game.Bartok.TSample.html#reverseDirection"><span class="hs-identifier">reverseDirection</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#modifyPlayers"><span class="hs-identifier hs-var">modifyPlayers</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679154467"><a href="#local-6989586621679154467"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679154468"><a href="#local-6989586621679154468"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><a href="#local-6989586621679154467"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><span class="hs-identifier hs-var">reverse</span><span> </span><a href="#local-6989586621679154468"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span>
</span><a name="line-32"></a><span>
</span><a name="line-33"></a><span class="hs-comment">-- When a card is legal and is a Queen, reverse direction.</span><span>
</span><a name="line-34"></a><span class="hs-comment">-- This needs to use 'doBefore' rather than 'doAfter' since the inner ruleset is</span><span>
</span><a name="line-35"></a><span class="hs-comment">-- responsible for advancing the turn, so we need to reverse the order before</span><span>
</span><a name="line-36"></a><span class="hs-comment">-- the inner ruleset runs.</span><span>
</span><a name="line-37"></a><span class="hs-comment">--</span><span>
</span><a name="line-38"></a><span class="hs-comment">-- Note that using doBefore wouldn't work with r8, because the inner ruleset checks</span><span>
</span><a name="line-39"></a><span class="hs-comment">-- who's turn it is, so if a turn was skipped before the card was played, the move would become illegal</span><span>
</span><a name="line-40"></a><span class="hs-identifier">rq'</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-41"></a><a name="rq%27"><a href="Game.Bartok.TSample.html#rq%27"><span class="hs-identifier">rq'</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="Game.Bartok.DataTypes.html#Queen"><span class="hs-identifier hs-var">Queen</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-42"></a><span>      </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><a href="Game.Bartok.TSample.html#reverseDirection"><span class="hs-identifier hs-var">reverseDirection</span></a><span class="hs-special">)</span><span>
</span><a name="line-43"></a><span>
</span><a name="line-44"></a><span class="hs-comment">-- This is an improvement to rq'. It is possible that playing a queen may become illegal if the</span><span>
</span><a name="line-45"></a><span class="hs-comment">-- turn order is reversed (that cannot happen under standard rules, but imagine</span><span>
</span><a name="line-46"></a><span class="hs-comment">-- someone has already added a rule requiring that you say the name of the next player),</span><span>
</span><a name="line-47"></a><span class="hs-comment">-- in which case the direction would be reversed, but the card would not be played.</span><span>
</span><a name="line-48"></a><span class="hs-comment">-- This is better - it does not check if the move is legal before reversing direction</span><span>
</span><a name="line-49"></a><span class="hs-comment">-- and if the move was illegal, then it undoes the reversal.</span><span>
</span><a name="line-50"></a><span class="hs-identifier">rq</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-51"></a><a name="rq"><a href="Game.Bartok.TSample.html#rq"><span class="hs-identifier">rq</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="Game.Bartok.DataTypes.html#Queen"><span class="hs-identifier hs-var">Queen</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-52"></a><span>      </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><a href="Game.Bartok.TSample.html#reverseDirection"><span class="hs-identifier hs-var">reverseDirection</span></a><span>
</span><a name="line-53"></a><span>        </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#not_"><span class="hs-identifier hs-var">not_</span></a><span> </span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><a href="Game.Bartok.TSample.html#reverseDirection"><span class="hs-identifier hs-var">reverseDirection</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-54"></a><span>
</span><a name="line-55"></a><span class="hs-comment">-- Penalize players that do not name the card when a spade is played.</span><span>
</span><a name="line-56"></a><span class="hs-comment">-- @\ game -&gt; foldr ($) game rules@ combines a list of @rules@ into a single rule.</span><span>
</span><a name="line-57"></a><span class="hs-comment">-- 'sometimesSay' means that players will be penalized if they name a spade which is not played.</span><span>
</span><a name="line-58"></a><span class="hs-identifier">rSpade</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-59"></a><a name="rSpade"><a href="Game.Bartok.TSample.html#rSpade"><span class="hs-identifier">rSpade</span></a></a><span> </span><a name="local-6989586621679154469"><a href="#local-6989586621679154469"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">$</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154469"><span class="hs-identifier hs-var">inner</span></a><span>  </span><span class="hs-special">[</span><a href="Game.Bartok.TLib.html#sometimesSay"><span class="hs-identifier hs-var">sometimesSay</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;{} of Spades&quot;</span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679154470"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span class="hs-special">(</span><a href="#local-6989586621679154470"><span class="hs-identifier hs-var">r</span></a><span class="hs-special">,</span><a href="Game.Bartok.DataTypes.html#Spades"><span class="hs-identifier hs-var">Spades</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>  </span><span class="hs-glyph">|</span><span> </span><a name="local-6989586621679154470"><a href="#local-6989586621679154470"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">&lt;-</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Ace"><span class="hs-identifier hs-var">Ace</span></a><span> </span><span class="hs-glyph">..</span><span> </span><a href="Game.Bartok.DataTypes.html#King"><span class="hs-identifier hs-var">King</span></a><span class="hs-special">]</span><span class="hs-special">]</span><span>
</span><a name="line-60"></a><span>
</span><a name="line-61"></a><span>
</span><a name="line-62"></a><a name="swp"><a href="Game.Bartok.TSample.html#swp"><span class="hs-identifier">swp</span></a></a><span> </span><a name="local-6989586621679154471"><a href="#local-6989586621679154471"><span class="hs-identifier">a</span></a></a><span> </span><a name="local-6989586621679154472"><a href="#local-6989586621679154472"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#mapAllCards"><span class="hs-identifier hs-var">mapAllCards</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154473"><a href="#local-6989586621679154473"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154471"><span class="hs-identifier hs-var">a</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154473"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679154472"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154472"><span class="hs-identifier hs-var">b</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154473"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679154471"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679154473"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-63"></a><span>
</span><a name="line-64"></a><span class="hs-identifier">rAlternate</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-65"></a><a name="rAlternate"><a href="Game.Bartok.TSample.html#rAlternate"><span class="hs-identifier">rAlternate</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><a href="Game.Bartok.TLib.html#state"><span class="hs-identifier hs-var">state</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#__"><span class="hs-identifier hs-var">__</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier">_pile</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154474"><span class="hs-identifier hs-var">s</span></a><span>
</span><a name="line-66"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-67"></a><span>    </span><a name="local-6989586621679154474"><a href="#local-6989586621679154474"><span class="hs-identifier">s</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679154475"><a href="#local-6989586621679154475"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-operator hs-var">NE.:|</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154476"><a href="#local-6989586621679154476"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">:</span><span> </span><a name="local-6989586621679154477"><a href="#local-6989586621679154477"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#swp"><span class="hs-identifier hs-var">swp</span></a><span> </span><a href="#local-6989586621679154475"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679154476"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#swp"><span class="hs-identifier hs-var">swp</span></a><span> </span><a href="#local-6989586621679154475"><span class="hs-identifier hs-var">a</span></a><span> </span><a href="#local-6989586621679154476"><span class="hs-identifier hs-var">b</span></a><span class="hs-special">)</span><span>
</span><a name="line-68"></a><span>    </span><span class="hs-identifier">s</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">id</span><span>
</span><a name="line-69"></a><span>
</span><a name="line-70"></a><a name="piList"><a href="Game.Bartok.TSample.html#piList"><span class="hs-identifier">piList</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">1</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">6</span><span class="hs-special">,</span><span class="hs-number">4</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">8</span><span class="hs-special">,</span><span class="hs-number">3</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">,</span><span class="hs-number">7</span><span class="hs-special">,</span><span class="hs-number">9</span><span class="hs-special">,</span><span class="hs-number">5</span><span class="hs-special">,</span><span class="hs-number">0</span><span class="hs-special">,</span><span class="hs-number">2</span><span class="hs-special">]</span><span>
</span><a name="line-71"></a><span>
</span><a name="line-72"></a><span class="hs-comment">-- Consider moving to TLib</span><span>
</span><a name="line-73"></a><span class="hs-identifier">isDraw</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.TLib.html#GEGSto"><span class="hs-identifier hs-type">GEGSto</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-74"></a><a name="isDraw"><a href="Game.Bartok.TSample.html#isDraw"><span class="hs-identifier">isDraw</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#actionIs"><span class="hs-identifier hs-var">actionIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154478"><a href="#local-6989586621679154478"><span class="hs-identifier">a</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-keyword">case</span><span> </span><a href="#local-6989586621679154478"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-75"></a><span>  </span><a href="Game.Bartok.DataTypes.html#Draw"><span class="hs-identifier hs-var">Draw</span></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">True</span><span>
</span><a name="line-76"></a><span>  </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-var">False</span><span class="hs-special">)</span><span>
</span><a name="line-77"></a><span>
</span><a name="line-78"></a><span class="hs-comment">-- Consider moving to TLib</span><span>
</span><a name="line-79"></a><span class="hs-identifier">isActivePlayer</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.TLib.html#GEGSto"><span class="hs-identifier hs-type">GEGSto</span></a><span> </span><span class="hs-identifier hs-type">Bool</span><span>
</span><a name="line-80"></a><a name="isActivePlayer"><a href="Game.Bartok.TSample.html#isActivePlayer"><span class="hs-identifier">isActivePlayer</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#Action"><span class="hs-identifier hs-var">Action</span></a><span> </span><a name="local-6989586621679154479"><a href="#local-6989586621679154479"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679154480"><a href="#local-6989586621679154480"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">head</span><span> </span><span class="hs-special">(</span><span class="hs-identifier">_players</span><span> </span><a href="#local-6989586621679154480"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154479"><span class="hs-identifier hs-var">p</span></a><span>
</span><a name="line-81"></a><span class="hs-identifier">isActivePlayer</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">False</span><span>
</span><a name="line-82"></a><span>
</span><a name="line-83"></a><span>
</span><a name="line-84"></a><span class="hs-comment">-- Note: This rule uses 'play', and skips the inner ruleset.</span><span>
</span><a name="line-85"></a><span class="hs-comment">-- It is usually better to modify the gamestate so that inner rules get a chance</span><span>
</span><a name="line-86"></a><span class="hs-comment">-- (see rAlternate or rAce)</span><span>
</span><a name="line-87"></a><span class="hs-identifier">rPi</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-88"></a><a name="rPi"><a href="Game.Bartok.TSample.html#rPi"><span class="hs-identifier">rPi</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#withCard"><span class="hs-identifier hs-var">withCard</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154481"><a href="#local-6989586621679154481"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-89"></a><span>  </span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#getVar"><span class="hs-identifier hs-var">getVar</span></a><span> </span><span class="hs-string">&quot;piPlace&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154482"><a href="#local-6989586621679154482"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-90"></a><span>    </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679154482"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">==</span><span class="hs-number">0</span><span>
</span><a name="line-91"></a><span>      </span><span class="hs-keyword">then</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><span> </span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#__"><span class="hs-identifier hs-var">__</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span> </span><a href="#local-6989586621679154481"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Game.Bartok.DataTypes.html#Three"><span class="hs-identifier hs-var">Three</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;piPlace&quot;</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154482"><span class="hs-identifier hs-var">n</span></a><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-92"></a><span>      </span><span class="hs-keyword">else</span><span>
</span><a name="line-93"></a><span>        </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679154483"><a href="#local-6989586621679154483"><span class="hs-identifier">r</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span> </span><a href="#local-6989586621679154481"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-94"></a><span>            </span><a name="local-6989586621679154484"><a href="#local-6989586621679154484"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#piList"><span class="hs-identifier hs-var">piList</span></a><span> </span><span class="hs-operator hs-var">!!</span><span> </span><a href="#local-6989586621679154482"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-95"></a><span>              </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679154483"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154484"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-96"></a><span>                </span><span class="hs-keyword">then</span><span> </span><a href="Game.Bartok.TLib.html#withPlayer"><span class="hs-identifier hs-var">withPlayer</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679154485"><a href="#local-6989586621679154485"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679154486"><a href="#local-6989586621679154486"><span class="hs-identifier">e</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.BaseGame.html#play"><span class="hs-identifier hs-var">play</span></a><span> </span><a href="#local-6989586621679154485"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679154486"><span class="hs-identifier hs-var">e</span></a><span> </span><a href="#local-6989586621679154481"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>   </span><span class="hs-comment">--BaseGame.play</span><span>
</span><a name="line-97"></a><span>                  </span><span class="hs-comment">-- could also advance the turn to follow the player, or check that the player is active</span><span>
</span><a name="line-98"></a><span>                </span><span class="hs-keyword">else</span><span> </span><a href="Game.Bartok.TLib.html#doOnly"><span class="hs-identifier hs-var">doOnly</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.BaseGame.html#illegal"><span class="hs-identifier hs-var">illegal</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-string">&quot;Failure to continue pi&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-99"></a><span>  </span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-100"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#isDraw"><span class="hs-identifier hs-var">isDraw</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TSample.html#isActivePlayer"><span class="hs-identifier hs-var">isActivePlayer</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;piPlace&quot;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-101"></a><span>
</span><a name="line-102"></a><span class="hs-comment">-- Consider moving to TLib</span><span>
</span><a name="line-103"></a><span class="hs-identifier">mhead</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679154466"><span class="hs-identifier hs-type">a</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="#local-6989586621679154466"><span class="hs-identifier hs-type">a</span></a><span>
</span><a name="line-104"></a><a name="mhead"><a href="Game.Bartok.TSample.html#mhead"><span class="hs-identifier">mhead</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-105"></a><span class="hs-identifier">mhead</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154487"><a href="#local-6989586621679154487"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679154487"><span class="hs-identifier hs-var">c</span></a><span>
</span><a name="line-106"></a><span>
</span><a name="line-107"></a><span class="hs-comment">-- Consider moving to TLib</span><span>
</span><a name="line-108"></a><span class="hs-comment">-- | Modify the current player's hand. Do nothing if the event is not an action</span><span>
</span><a name="line-109"></a><span class="hs-identifier">modifyHand</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span class="hs-glyph">-&gt;</span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.DataTypes.html#Event"><span class="hs-identifier hs-type">Event</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.DataTypes.html#Step"><span class="hs-identifier hs-type">Step</span></a><span>
</span><a name="line-110"></a><a name="modifyHand"><a href="Game.Bartok.TSample.html#modifyHand"><span class="hs-identifier">modifyHand</span></a></a><span> </span><a name="local-6989586621679154488"><a href="#local-6989586621679154488"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#Action"><span class="hs-identifier hs-var">Action</span></a><span> </span><a name="local-6989586621679154489"><a href="#local-6989586621679154489"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><a name="local-6989586621679154490"><a href="#local-6989586621679154490"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154490"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">{</span><span class="hs-identifier">_hands</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">Map.adjust</span><span> </span><a href="#local-6989586621679154488"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679154489"><span class="hs-identifier hs-var">p</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_hands</span><span> </span><a href="#local-6989586621679154490"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span class="hs-special">}</span><span>
</span><a name="line-111"></a><span class="hs-identifier">modifyHand</span><span> </span><span class="hs-identifier">_</span><span> </span><span class="hs-identifier">_</span><span> </span><a name="local-6989586621679154491"><a href="#local-6989586621679154491"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154491"><span class="hs-identifier hs-var">gs</span></a><span>
</span><a name="line-112"></a><span>
</span><a name="line-113"></a><span class="hs-comment">-- Consider moving to TLib</span><span>
</span><a name="line-114"></a><a name="setHand"><a href="Game.Bartok.TSample.html#setHand"><span class="hs-identifier">setHand</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#modifyHand"><span class="hs-identifier hs-var">modifyHand</span></a><span> </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-identifier hs-var">const</span><span>
</span><a name="line-115"></a><span>
</span><a name="line-116"></a><span class="hs-identifier">rKnight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-117"></a><a name="rKnight"><a href="Game.Bartok.TSample.html#rKnight"><span class="hs-identifier">rKnight</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#withHand"><span class="hs-identifier hs-var">withHand</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154492"><a href="#local-6989586621679154492"><span class="hs-identifier">hinit</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-118"></a><span>    </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154493"><a href="#local-6989586621679154493"><span class="hs-identifier">ks</span></a></a><span class="hs-special">,</span><span> </span><a name="local-6989586621679154494"><a href="#local-6989586621679154494"><span class="hs-identifier">hfree</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#takeKnights"><span class="hs-identifier hs-var">takeKnights</span></a><span> </span><a href="#local-6989586621679154492"><span class="hs-identifier hs-var">hinit</span></a><span>
</span><a name="line-119"></a><span>      </span><span class="hs-keyword">in</span><span> </span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#setHand"><span class="hs-identifier hs-var">setHand</span></a><span> </span><a href="#local-6989586621679154494"><span class="hs-identifier hs-var">hfree</span></a><span class="hs-special">)</span><span>
</span><a name="line-120"></a><span>        </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#modifyHand"><span class="hs-identifier hs-var">modifyHand</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TSample.html#addKnights"><span class="hs-identifier hs-var">addKnights</span></a><span> </span><a href="#local-6989586621679154493"><span class="hs-identifier hs-var">ks</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-121"></a><span>  </span><span class="hs-special">)</span><span>
</span><a name="line-122"></a><span>
</span><a name="line-123"></a><span class="hs-keyword">type</span><span> </span><a name="PlaceHolder"><a href="Game.Bartok.TSample.html#PlaceHolder"><span class="hs-identifier">PlaceHolder</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">,</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">,</span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">)</span><span>
</span><a name="line-124"></a><span>
</span><a name="line-125"></a><span class="hs-comment">-- | Given a hand, remove all knights from it, with enough Data to reinsert them</span><span>
</span><a name="line-126"></a><span class="hs-identifier">takeKnights</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Game.Bartok.TSample.html#PlaceHolder"><span class="hs-identifier hs-type">PlaceHolder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-127"></a><a name="takeKnights"><a href="Game.Bartok.TSample.html#takeKnights"><span class="hs-identifier">takeKnights</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#takeKnights%27"><span class="hs-identifier hs-var">takeKnights'</span></a><span> </span><span class="hs-identifier hs-var">Nothing</span><span>
</span><a name="line-128"></a><span>
</span><a name="line-129"></a><span class="hs-identifier">takeKnights'</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Maybe</span><span> </span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><a href="Game.Bartok.TSample.html#PlaceHolder"><span class="hs-identifier hs-type">PlaceHolder</span></a><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-130"></a><a name="takeKnights%27"><a href="Game.Bartok.TSample.html#takeKnights%27"><span class="hs-identifier">takeKnights'</span></a></a><span> </span><a name="local-6989586621679154495"><a href="#local-6989586621679154495"><span class="hs-identifier">mc</span></a></a><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">,</span><span class="hs-special">[</span><span class="hs-special">]</span><span class="hs-special">)</span><span>
</span><a name="line-131"></a><span class="hs-identifier">takeKnights'</span><span> </span><a name="local-6989586621679154496"><a href="#local-6989586621679154496"><span class="hs-identifier">mc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679154497"><a href="#local-6989586621679154497"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#Knight"><span class="hs-identifier hs-var">Knight</span></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span class="hs-glyph">:</span><a name="local-6989586621679154498"><a href="#local-6989586621679154498"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-132"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154499"><a href="#local-6989586621679154499"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154500"><a href="#local-6989586621679154500"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#takeKnights%27"><span class="hs-identifier hs-var">takeKnights'</span></a><span> </span><a href="#local-6989586621679154496"><span class="hs-identifier hs-var">mc</span></a><span> </span><a href="#local-6989586621679154498"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="#local-6989586621679154496"><span class="hs-identifier hs-var">mc</span></a><span class="hs-special">,</span><a href="#local-6989586621679154497"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">,</span><a href="Game.Bartok.TSample.html#mhead"><span class="hs-identifier hs-var">mhead</span></a><span> </span><a href="#local-6989586621679154498"><span class="hs-identifier hs-var">cs</span></a><span class="hs-special">)</span><span class="hs-glyph">:</span><a href="#local-6989586621679154499"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><a href="#local-6989586621679154500"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-133"></a><span class="hs-identifier">takeKnights'</span><span> </span><a name="local-6989586621679154501"><a href="#local-6989586621679154501"><span class="hs-identifier">mc</span></a></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679154502"><a href="#local-6989586621679154502"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679154503"><a href="#local-6989586621679154503"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span>
</span><a name="line-134"></a><span>  </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154504"><a href="#local-6989586621679154504"><span class="hs-identifier">ps</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154505"><a href="#local-6989586621679154505"><span class="hs-identifier">rs</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TSample.html#takeKnights%27"><span class="hs-identifier hs-var">takeKnights'</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679154502"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154503"><span class="hs-identifier hs-var">cs</span></a><span> </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154504"><span class="hs-identifier hs-var">ps</span></a><span class="hs-special">,</span><a href="#local-6989586621679154502"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679154505"><span class="hs-identifier hs-var">rs</span></a><span class="hs-special">)</span><span>
</span><a name="line-135"></a><span>
</span><a name="line-136"></a><span class="hs-comment">-- | Add a collection of cards back into a hand in approximately the right places</span><span>
</span><a name="line-137"></a><span class="hs-identifier">addKnights</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.TSample.html#PlaceHolder"><span class="hs-identifier hs-type">PlaceHolder</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span>
</span><a name="line-138"></a><a name="addKnights"><a href="Game.Bartok.TSample.html#addKnights"><span class="hs-identifier">addKnights</span></a></a><span> </span><a name="local-6989586621679154506"><a href="#local-6989586621679154506"><span class="hs-identifier">ps</span></a></a><span> </span><a name="local-6989586621679154507"><a href="#local-6989586621679154507"><span class="hs-identifier">cs</span></a></a><span>  </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Game.Bartok.TSample.html#addKnight"><span class="hs-identifier hs-var">addKnight</span></a><span> </span><a href="#local-6989586621679154507"><span class="hs-identifier hs-var">cs</span></a><span> </span><a href="#local-6989586621679154506"><span class="hs-identifier hs-var">ps</span></a><span>
</span><a name="line-139"></a><span>
</span><a name="line-140"></a><span class="hs-identifier">addKnight</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.TSample.html#PlaceHolder"><span class="hs-identifier hs-type">PlaceHolder</span></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">[</span><a href="Game.Bartok.DataTypes.html#Card"><span class="hs-identifier hs-type">Card</span></a><span class="hs-special">]</span><span>
</span><a name="line-141"></a><a name="addKnight"><a href="Game.Bartok.TSample.html#addKnight"><span class="hs-identifier">addKnight</span></a></a><span> </span><span class="hs-special">(</span><span class="hs-identifier">_</span><span class="hs-special">,</span><a name="local-6989586621679154508"><a href="#local-6989586621679154508"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><span class="hs-identifier">_</span><span class="hs-special">)</span><span> </span><span class="hs-special">[</span><span class="hs-special">]</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679154508"><span class="hs-identifier hs-var">k</span></a><span class="hs-special">]</span><span>
</span><a name="line-142"></a><span class="hs-identifier">addKnight</span><span> </span><a name="local-6989586621679154509"><a href="#local-6989586621679154509"><span class="hs-identifier">p</span></a></a><span class="hs-glyph">@</span><span class="hs-special">(</span><a name="local-6989586621679154510"><a href="#local-6989586621679154510"><span class="hs-identifier">a</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154511"><a href="#local-6989586621679154511"><span class="hs-identifier">k</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154512"><a href="#local-6989586621679154512"><span class="hs-identifier">b</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154513"><a href="#local-6989586621679154513"><span class="hs-identifier">c</span></a></a><span class="hs-glyph">:</span><a name="local-6989586621679154514"><a href="#local-6989586621679154514"><span class="hs-identifier">cs</span></a></a><span class="hs-special">)</span><span>
</span><a name="line-143"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679154513"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154510"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154513"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679154511"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679154514"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-144"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">Just</span><span> </span><a href="#local-6989586621679154513"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154512"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154511"><span class="hs-identifier hs-var">k</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679154513"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="#local-6989586621679154514"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-145"></a><span>  </span><span class="hs-glyph">|</span><span> </span><span class="hs-identifier hs-var">otherwise</span><span>   </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154513"><span class="hs-identifier hs-var">c</span></a><span class="hs-glyph">:</span><a href="Game.Bartok.TSample.html#addKnight"><span class="hs-identifier hs-var">addKnight</span></a><span> </span><a href="#local-6989586621679154509"><span class="hs-identifier hs-var">p</span></a><span> </span><a href="#local-6989586621679154514"><span class="hs-identifier hs-var">cs</span></a><span>
</span><a name="line-146"></a><span>
</span><a name="line-147"></a><span class="hs-comment">-- When a 3 is played, treat all cards of that suit as though they were one higher.</span><span>
</span><a name="line-148"></a><span class="hs-comment">-- This is implemented by internally incrementing everything of that suit once,</span><span>
</span><a name="line-149"></a><span class="hs-comment">-- then reducing them in the view.</span><span>
</span><a name="line-150"></a><span class="hs-identifier">r3</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-151"></a><a name="r3"><a href="Game.Bartok.TSample.html#r3"><span class="hs-identifier">r3</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="Game.Bartok.DataTypes.html#Three"><span class="hs-identifier hs-var">Three</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-152"></a><span>    </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#withCard"><span class="hs-identifier hs-var">withCard</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679154515"><a href="#local-6989586621679154515"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154516"><a href="#local-6989586621679154516"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#modifyVar"><span class="hs-identifier hs-var">modifyVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679154516"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-153"></a><span>                              </span><a href="Game.Bartok.TLib.html#mapAllCards"><span class="hs-identifier hs-var">mapAllCards</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span class="hs-special">(</span><a name="local-6989586621679154517"><a href="#local-6989586621679154517"><span class="hs-identifier">r'</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154518"><a href="#local-6989586621679154518"><span class="hs-identifier">s'</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><span class="hs-special">(</span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679154516"><span class="hs-identifier hs-var">s</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154518"><span class="hs-identifier hs-var">s'</span></a><span> </span><span class="hs-keyword">then</span><span> </span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679154517"><span class="hs-identifier hs-var">r'</span></a><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">14</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679154517"><span class="hs-identifier hs-var">r'</span></a><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154518"><span class="hs-identifier hs-var">s'</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-154"></a><span>
</span><a name="line-155"></a><span class="hs-comment">-- Note that this does not mess with messages, giving people some ability to keep track</span><span>
</span><a name="line-156"></a><span class="hs-identifier">r3V</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#ViewRule"><span class="hs-identifier hs-type">ViewRule</span></a><span>
</span><a name="line-157"></a><a name="r3V"><a href="Game.Bartok.TSample.html#r3V"><span class="hs-identifier">r3V</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679154519"><a href="#local-6989586621679154519"><span class="hs-identifier">v</span></a></a><span> </span><a name="local-6989586621679154520"><a href="#local-6989586621679154520"><span class="hs-identifier">n</span></a></a><span> </span><a name="local-6989586621679154521"><a href="#local-6989586621679154521"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-158"></a><span>  </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679154522"><a href="#local-6989586621679154522"><span class="hs-identifier">f</span></a></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#CardFace"><span class="hs-identifier hs-var">CardFace</span></a><span> </span><span class="hs-special">(</span><a name="local-6989586621679154523"><a href="#local-6989586621679154523"><span class="hs-identifier">r</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154524"><a href="#local-6989586621679154524"><span class="hs-identifier">s</span></a></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.DataTypes.html#CardFace"><span class="hs-identifier hs-var">CardFace</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">toEnum</span><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><a href="#local-6989586621679154523"><span class="hs-identifier hs-var">r</span></a><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">-</span><span> </span><a href="Game.Bartok.DataTypes.html#readVar"><span class="hs-identifier hs-var">readVar</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">show</span><span> </span><a href="#local-6989586621679154524"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154521"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">`</span><span class="hs-identifier hs-var">mod</span><span class="hs-special">`</span><span> </span><span class="hs-number">14</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">+</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">,</span><span> </span><a href="#local-6989586621679154524"><span class="hs-identifier hs-var">s</span></a><span class="hs-special">)</span><span>
</span><a name="line-159"></a><span>      </span><span class="hs-identifier">f</span><span> </span><a name="local-6989586621679154525"><a href="#local-6989586621679154525"><span class="hs-identifier">x</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="#local-6989586621679154525"><span class="hs-identifier hs-var">x</span></a><span> </span><span class="hs-keyword">in</span><span>
</span><a name="line-160"></a><span>    </span><span class="hs-keyword">case</span><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154519"><span class="hs-identifier hs-var">v</span></a><span> </span><a href="#local-6989586621679154520"><span class="hs-identifier hs-var">n</span></a><span> </span><a href="#local-6989586621679154521"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">)</span><span> </span><span class="hs-keyword">of</span><span>
</span><a name="line-161"></a><span>      </span><a href="Game.Bartok.DataTypes.html#GV"><span class="hs-identifier hs-var">GV</span></a><span> </span><a name="local-6989586621679154526"><a href="#local-6989586621679154526"><span class="hs-identifier">hs</span></a></a><span> </span><a name="local-6989586621679154527"><a href="#local-6989586621679154527"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679154528"><a href="#local-6989586621679154528"><span class="hs-identifier">d</span></a></a><span> </span><a name="local-6989586621679154529"><a href="#local-6989586621679154529"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.Views.html#mapHands"><span class="hs-identifier hs-var">mapHands</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679154522"><span class="hs-identifier hs-var">f</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#GV"><span class="hs-identifier hs-var">GV</span></a><span> </span><a href="#local-6989586621679154526"><span class="hs-identifier hs-var">hs</span></a><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679154522"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679154527"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">map</span><span> </span><a href="#local-6989586621679154522"><span class="hs-identifier hs-var">f</span></a><span> </span><a href="#local-6989586621679154528"><span class="hs-identifier hs-var">d</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154529"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-identifier hs-var">undefined</span><span> </span><span class="hs-identifier hs-var">undefined</span><span>
</span><a name="line-162"></a><span>    </span><span class="hs-special">)</span><span>
</span><a name="line-163"></a><span>
</span><a name="line-164"></a><span>
</span><a name="line-165"></a><span>
</span><a name="line-166"></a><span class="hs-identifier">rBadgerN</span><span> </span><span class="hs-glyph">::</span><span> </span><span class="hs-identifier hs-type">Int</span><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-167"></a><a name="rBadgerN"><a href="Game.Bartok.TSample.html#rBadgerN"><span class="hs-identifier">rBadgerN</span></a></a><span> </span><a name="local-6989586621679154530"><a href="#local-6989586621679154530"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-168"></a><span>             </span><a href="Game.Bartok.TLib.html#sometimesSayPenalty"><span class="hs-identifier hs-var">sometimesSayPenalty</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;that's{} the badger&quot;</span><span> </span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><span> </span><a href="#local-6989586621679154531"><span class="hs-identifier hs-var">almosts</span></a><span class="hs-special">)</span><span>
</span><a name="line-169"></a><span>                           </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154532"><a href="#local-6989586621679154532"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.DataTypes.html#suit"><span class="hs-identifier hs-var">suit</span></a><span> </span><a href="#local-6989586621679154532"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Game.Bartok.DataTypes.html#Diamonds"><span class="hs-identifier hs-var">Diamonds</span></a><span> </span><span class="hs-operator hs-var">&amp;&amp;</span><span> </span><span class="hs-identifier hs-var">abs</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">fromEnum</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span> </span><a href="#local-6989586621679154532"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">-</span><span> </span><span class="hs-number">9</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154530"><span class="hs-identifier hs-var">n</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-170"></a><span>                           </span><span class="hs-special">(</span><span class="hs-string">&quot;Failure to{} identify the wildlife&quot;</span><span> </span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><span> </span><a href="#local-6989586621679154531"><span class="hs-identifier hs-var">almosts</span></a><span class="hs-special">)</span><span>
</span><a name="line-171"></a><span>                           </span><span class="hs-special">(</span><span class="hs-string">&quot;Incorrectly{} identifying wildlife&quot;</span><span> </span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><span> </span><a href="#local-6989586621679154531"><span class="hs-identifier hs-var">almosts</span></a><span class="hs-special">)</span><span>
</span><a name="line-172"></a><span>                 </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679154531"><a href="#local-6989586621679154531"><span class="hs-identifier">almosts</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679154530"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-string">&quot; almost&quot;</span><span>
</span><a name="line-173"></a><span>
</span><a name="line-174"></a><span class="hs-identifier">rBadger</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-175"></a><a name="rBadger"><a href="Game.Bartok.TSample.html#rBadger"><span class="hs-identifier">rBadger</span></a></a><span> </span><a name="local-6989586621679154533"><a href="#local-6989586621679154533"><span class="hs-identifier">inner</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">foldr</span><span> </span><a href="Game.Bartok.TSample.html#rBadgerN"><span class="hs-identifier hs-var">rBadgerN</span></a><span> </span><a href="#local-6989586621679154533"><span class="hs-identifier hs-var">inner</span></a><span> </span><span class="hs-special">[</span><span class="hs-number">0</span><span class="hs-glyph">..</span><span class="hs-number">2</span><span class="hs-special">]</span><span>
</span><a name="line-176"></a><span>
</span><a name="line-177"></a><span>
</span><a name="line-178"></a><span class="hs-identifier">rNoHTML</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-179"></a><a name="rNoHTML"><a href="Game.Bartok.TSample.html#rNoHTML"><span class="hs-identifier">rNoHTML</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#withMessage"><span class="hs-identifier hs-var">withMessage</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679154537"><a href="#local-6989586621679154537"><span class="hs-identifier">m</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-180"></a><span>    </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#__"><span class="hs-identifier hs-var">__</span></a><span class="hs-operator hs-var">$</span><span> </span><a href="#local-6989586621679154534"><span class="hs-identifier hs-var">sanitise</span></a><span> </span><a href="#local-6989586621679154537"><span class="hs-identifier hs-var">m</span></a><span> </span><span class="hs-operator hs-var">/=</span><span> </span><a href="#local-6989586621679154537"><span class="hs-identifier hs-var">m</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-181"></a><span>      </span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#penalty"><span class="hs-identifier hs-var">penalty</span></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-string">&quot;Hacking&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#modifyMessage"><span class="hs-identifier hs-var">modifyMessage</span></a><span> </span><a href="#local-6989586621679154534"><span class="hs-identifier hs-var">sanitise</span></a><span>
</span><a name="line-182"></a><span>  </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679154534"><a href="#local-6989586621679154534"><span class="hs-identifier">sanitise</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">&gt;&gt;=</span><span> </span><a href="#local-6989586621679154535"><span class="hs-identifier hs-var">sanChar</span></a><span class="hs-special">)</span><span>
</span><a name="line-183"></a><span>        </span><a name="local-6989586621679154535"><a href="#local-6989586621679154535"><span class="hs-identifier">sanChar</span></a></a><span> </span><span class="hs-char">'&lt;'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&amp;lt;&quot;</span><span>
</span><a name="line-184"></a><span>        </span><span class="hs-identifier">sanChar</span><span> </span><span class="hs-char">'&gt;'</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;&amp;gt;&quot;</span><span>
</span><a name="line-185"></a><span>        </span><span class="hs-identifier">sanChar</span><span> </span><a name="local-6989586621679154536"><a href="#local-6989586621679154536"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">[</span><a href="#local-6989586621679154536"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">]</span><span>
</span><a name="line-186"></a><span>
</span><a name="line-187"></a><span class="hs-comment">-- TODO: allow changing to a specific named suit</span><span>
</span><a name="line-188"></a><a name="rAce"><a href="Game.Bartok.TSample.html#rAce"><span class="hs-identifier">rAce</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#withCard"><span class="hs-identifier hs-var">withCard</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><span> </span><a name="local-6989586621679154538"><a href="#local-6989586621679154538"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#__"><span class="hs-identifier hs-var">__</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span> </span><a href="#local-6989586621679154538"><span class="hs-identifier hs-var">c</span></a><span> </span><span class="hs-operator hs-var">==</span><span> </span><a href="Game.Bartok.DataTypes.html#Ace"><span class="hs-identifier hs-var">Ace</span></a><span class="hs-special">)</span><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;rAce&quot;</span><span> </span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-189"></a><span> </span><span class="hs-operator hs-var">.</span><span>
</span><a name="line-190"></a><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#boolVar"><span class="hs-identifier hs-var">boolVar</span></a><span> </span><span class="hs-string">&quot;rAce&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#withCard"><span class="hs-identifier hs-var">withCard</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154539"><a href="#local-6989586621679154539"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-191"></a><span>   </span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><a href="Game.Bartok.TLib.html#getTop"><span class="hs-identifier hs-var">getTop</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154540"><a href="#local-6989586621679154540"><span class="hs-identifier">top</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-192"></a><span>     </span><span class="hs-keyword">let</span><span> </span><a name="local-6989586621679154541"><a href="#local-6989586621679154541"><span class="hs-identifier">t2</span></a></a><span>        </span><span class="hs-glyph">=</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span> </span><a href="#local-6989586621679154540"><span class="hs-identifier hs-var">top</span></a><span class="hs-special">,</span><span> </span><a href="Game.Bartok.DataTypes.html#suit"><span class="hs-identifier hs-var">suit</span></a><span> </span><a href="#local-6989586621679154539"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span>
</span><a name="line-193"></a><span>         </span><a name="local-6989586621679154542"><a href="#local-6989586621679154542"><span class="hs-identifier">swapTop</span></a></a><span> </span><a name="local-6989586621679154543"><a href="#local-6989586621679154543"><span class="hs-identifier">d</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679154543"><span class="hs-identifier hs-var">d</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154541"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679154540"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-keyword">else</span><span> </span><span class="hs-keyword">if</span><span> </span><a href="#local-6989586621679154543"><span class="hs-identifier hs-var">d</span></a><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154540"><span class="hs-identifier hs-var">top</span></a><span> </span><span class="hs-keyword">then</span><span> </span><a href="#local-6989586621679154541"><span class="hs-identifier hs-var">t2</span></a><span> </span><span class="hs-keyword">else</span><span> </span><a href="#local-6989586621679154543"><span class="hs-identifier hs-var">d</span></a><span>
</span><a name="line-194"></a><span>      </span><span class="hs-keyword">in</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span class="hs-operator hs-var">$</span><span> </span><a href="Game.Bartok.TLib.html#mapAllCards"><span class="hs-identifier hs-var">mapAllCards</span></a><span> </span><a href="#local-6989586621679154542"><span class="hs-identifier hs-var">swapTop</span></a><span class="hs-special">)</span><span>
</span><a name="line-195"></a><span>         </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span class="hs-operator hs-var">$</span><span> </span><a href="Game.Bartok.TLib.html#mapAllCards"><span class="hs-identifier hs-var">mapAllCards</span></a><span> </span><a href="#local-6989586621679154542"><span class="hs-identifier hs-var">swapTop</span></a><span class="hs-special">)</span><span>
</span><a name="line-196"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-197"></a><span>   </span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;rAce&quot;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-198"></a><span> </span><span class="hs-special">)</span><span>
</span><a name="line-199"></a><span class="hs-comment">-- map1 ; checkIfLegal ; innerAct ; map2</span><span>
</span><a name="line-200"></a><span>
</span><a name="line-201"></a><span>
</span><a name="line-202"></a><span class="hs-comment">-- Warning: unnec doesn't play nice with this</span><span>
</span><a name="line-203"></a><a name="rSnap"><a href="Game.Bartok.TSample.html#rSnap"><span class="hs-identifier">rSnap</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#not_"><span class="hs-identifier hs-var">not_</span></a><span class="hs-operator hs-var">$</span><span> </span><a href="Game.Bartok.TLib.html#boolVar"><span class="hs-identifier hs-var">boolVar</span></a><span> </span><span class="hs-string">&quot;extra_deck&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-204"></a><span>    </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><a href="Game.Bartok.DataTypes.html#shuffleDeck"><span class="hs-identifier hs-var">shuffleDeck</span></a><span>
</span><a name="line-205"></a><span>      </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;extra_deck&quot;</span><span> </span><span class="hs-number">1</span><span>
</span><a name="line-206"></a><span>      </span><span class="hs-operator hs-var">.</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154549"><a href="#local-6989586621679154549"><span class="hs-identifier">gs</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="#local-6989586621679154549"><span class="hs-identifier hs-var">gs</span></a><span class="hs-special">{</span><span class="hs-identifier">_deck</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier">_deck</span><span> </span><a href="#local-6989586621679154549"><span class="hs-identifier hs-var">gs</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-special">[</span><span class="hs-identifier hs-var">minBound</span><span class="hs-glyph">..</span><span class="hs-special">]</span><span class="hs-special">}</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-207"></a><span>  </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><a href="Game.Bartok.TLib.html#getTop"><span class="hs-identifier hs-var">getTop</span></a><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154550"><a href="#local-6989586621679154550"><span class="hs-identifier">c</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-208"></a><span>      </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><span> </span><a href="#local-6989586621679154550"><span class="hs-identifier hs-var">c</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#said"><span class="hs-identifier hs-var">said</span></a><span> </span><span class="hs-string">&quot;snap!&quot;</span><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">$</span><span>
</span><a name="line-209"></a><span>        </span><a href="Game.Bartok.TLib.html#withPlayer"><span class="hs-identifier hs-var">withPlayer</span></a><span> </span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-glyph">\</span><a name="local-6989586621679154551"><a href="#local-6989586621679154551"><span class="hs-identifier">p</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span> </span><a href="Game.Bartok.TLib.html#doBefore"><span class="hs-identifier hs-var">doBefore</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#modifyPlayers"><span class="hs-identifier hs-var">modifyPlayers</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154544"><span class="hs-identifier hs-var">makeFirst</span></a><span> </span><a href="#local-6989586621679154551"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-210"></a><span>  </span><span class="hs-keyword">where</span><span>
</span><a name="line-211"></a><span>    </span><a name="local-6989586621679154544"><a href="#local-6989586621679154544"><span class="hs-identifier">makeFirst</span></a></a><span> </span><a name="local-6989586621679154545"><a href="#local-6989586621679154545"><span class="hs-identifier">p</span></a></a><span> </span><a name="local-6989586621679154546"><a href="#local-6989586621679154546"><span class="hs-identifier">ps</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-keyword">let</span><span> </span><span class="hs-special">(</span><a name="local-6989586621679154547"><a href="#local-6989586621679154547"><span class="hs-identifier">l</span></a></a><span class="hs-special">,</span><a name="local-6989586621679154548"><a href="#local-6989586621679154548"><span class="hs-identifier">r</span></a></a><span class="hs-special">)</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">break</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="#local-6989586621679154545"><span class="hs-identifier hs-var">p</span></a><span class="hs-special">)</span><span> </span><a href="#local-6989586621679154546"><span class="hs-identifier hs-var">ps</span></a><span> </span><span class="hs-keyword">in</span><span> </span><a href="#local-6989586621679154548"><span class="hs-identifier hs-var">r</span></a><span class="hs-operator hs-var">++</span><a href="#local-6989586621679154547"><span class="hs-identifier hs-var">l</span></a><span>
</span><a name="line-212"></a><span>
</span><a name="line-213"></a><a name="local-6989586621679154552"><a href="#local-6989586621679154552"><span class="hs-identifier">a</span></a></a><span> </span><a name="%3E%7C%3C"><a href="Game.Bartok.TSample.html#%3E%7C%3C"><span class="hs-operator">&gt;|&lt;</span></a></a><span> </span><a name="local-6989586621679154553"><a href="#local-6989586621679154553"><span class="hs-identifier">b</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;(&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679154552"><span class="hs-identifier hs-var">a</span></a><span> </span><span class="hs-operator hs-var">++</span><span class="hs-string">&quot;|&quot;</span><span> </span><span class="hs-operator hs-var">++</span><span> </span><a href="#local-6989586621679154553"><span class="hs-identifier hs-var">b</span></a><span> </span><span class="hs-operator hs-var">++</span><span> </span><span class="hs-string">&quot;)&quot;</span><span>
</span><a name="line-214"></a><span>
</span><a name="line-215"></a><span class="hs-identifier">r7</span><span> </span><span class="hs-glyph">::</span><span> </span><a href="Game.Bartok.DataTypes.html#Rule"><span class="hs-identifier hs-type">Rule</span></a><span>
</span><a name="line-216"></a><a name="r7"><a href="Game.Bartok.TSample.html#r7"><span class="hs-identifier">r7</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#unnecPenalty"><span class="hs-identifier hs-var">unnecPenalty</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;thank you(( very)* very much)?&quot;</span><span> </span><a href="Game.Bartok.TSample.html#%3E%7C%3C"><span class="hs-operator hs-var">&gt;|&lt;</span></a><span> </span><span class="hs-string">&quot;have a( very)* nice day&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-identifier hs-var">const</span><span> </span><span class="hs-string">&quot;Excessive politeness&quot;</span><span class="hs-special">)</span><span>
</span><a name="line-217"></a><span>   </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#with"><span class="hs-identifier hs-var">with</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#getVar"><span class="hs-identifier hs-var">getVar</span></a><span> </span><span class="hs-string">&quot;r7&quot;</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span class="hs-glyph">\</span><a name="local-6989586621679154559"><a href="#local-6989586621679154559"><span class="hs-identifier">nsevens</span></a></a><span> </span><span class="hs-glyph">-&gt;</span><span>
</span><a name="line-218"></a><span>       </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#isLegal"><span class="hs-identifier hs-var">isLegal</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="#local-6989586621679154554"><span class="hs-identifier hs-var">isSeven</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-219"></a><span>           </span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#modifyVar"><span class="hs-identifier hs-var">modifyVar</span></a><span> </span><span class="hs-string">&quot;r7&quot;</span><span> </span><span class="hs-special">(</span><span class="hs-operator hs-var">+</span><span class="hs-number">1</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-220"></a><span>         </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#mustSay"><span class="hs-identifier hs-var">mustSay</span></a><span> </span><span class="hs-special">(</span><span class="hs-string">&quot;have a{} nice day&quot;</span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><a href="#local-6989586621679154556"><span class="hs-identifier hs-var">veries</span></a><span> </span><a href="#local-6989586621679154559"><span class="hs-identifier hs-var">nsevens</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">)</span><span>
</span><a name="line-221"></a><span>       </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#when"><span class="hs-identifier hs-var">when</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#boolVar"><span class="hs-identifier hs-var">boolVar</span></a><span> </span><span class="hs-string">&quot;r7&quot;</span><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#isTurn"><span class="hs-identifier hs-var">isTurn</span></a><span> </span><a href="Game.Bartok.TLib.html#~%26~"><span class="hs-operator hs-var">~&amp;~</span></a><span> </span><a href="Game.Bartok.TLib.html#not_"><span class="hs-identifier hs-var">not_</span></a><span> </span><a href="#local-6989586621679154554"><span class="hs-identifier hs-var">isSeven</span></a><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><a href="Game.Bartok.TLib.html#mustDo"><span class="hs-identifier hs-var">mustDo</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#Draw"><span class="hs-identifier hs-var">Draw</span></a><span> </span><span class="hs-special">(</span><span class="hs-number">2</span><span class="hs-operator hs-var">*</span><a href="#local-6989586621679154559"><span class="hs-identifier hs-var">nsevens</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span> </span><span class="hs-special">(</span><span>
</span><a name="line-222"></a><span>           </span><a href="Game.Bartok.TLib.html#doAfter"><span class="hs-identifier hs-var">doAfter</span></a><span> </span><span class="hs-special">(</span><a href="Game.Bartok.DataTypes.html#setVar"><span class="hs-identifier hs-var">setVar</span></a><span> </span><span class="hs-string">&quot;r7&quot;</span><span> </span><span class="hs-number">0</span><span class="hs-special">)</span><span>
</span><a name="line-223"></a><span>         </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.TLib.html#mustSay"><span class="hs-identifier hs-var">mustSay</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154555"><span class="hs-identifier hs-var">thanks</span></a><span> </span><a href="#local-6989586621679154559"><span class="hs-identifier hs-var">nsevens</span></a><span class="hs-special">)</span><span class="hs-special">)</span><span class="hs-special">)</span><span>
</span><a name="line-224"></a><span>     </span><span class="hs-special">)</span><span>
</span><a name="line-225"></a><span>     </span><span class="hs-keyword">where</span><span> </span><a name="local-6989586621679154554"><a href="#local-6989586621679154554"><span class="hs-identifier">isSeven</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><a href="Game.Bartok.TLib.html#cardIs"><span class="hs-identifier hs-var">cardIs</span></a><span> </span><span class="hs-special">(</span><span class="hs-special">(</span><span class="hs-operator hs-var">==</span><a href="Game.Bartok.DataTypes.html#Seven"><span class="hs-identifier hs-var">Seven</span></a><span class="hs-special">)</span><span> </span><span class="hs-operator hs-var">.</span><span> </span><a href="Game.Bartok.DataTypes.html#rank"><span class="hs-identifier hs-var">rank</span></a><span class="hs-special">)</span><span>
</span><a name="line-226"></a><span>           </span><a name="local-6989586621679154555"><a href="#local-6989586621679154555"><span class="hs-identifier">thanks</span></a></a><span> </span><span class="hs-number">1</span><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;thank you&quot;</span><span>
</span><a name="line-227"></a><span>           </span><span class="hs-identifier">thanks</span><span> </span><a name="local-6989586621679154557"><a href="#local-6989586621679154557"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-string">&quot;thank you{} much&quot;</span><a href="Game.Bartok.BaseGame.html#%25"><span class="hs-operator hs-var">%</span></a><a href="#local-6989586621679154556"><span class="hs-identifier hs-var">veries</span></a><span> </span><span class="hs-special">(</span><a href="#local-6989586621679154557"><span class="hs-identifier hs-var">n</span></a><span class="hs-glyph">-</span><span class="hs-number">1</span><span class="hs-special">)</span><span>
</span><a name="line-228"></a><span>           </span><a name="local-6989586621679154556"><a href="#local-6989586621679154556"><span class="hs-identifier">veries</span></a></a><span> </span><a name="local-6989586621679154558"><a href="#local-6989586621679154558"><span class="hs-identifier">n</span></a></a><span> </span><span class="hs-glyph">=</span><span> </span><span class="hs-identifier hs-var">concat</span><span class="hs-operator hs-var">$</span><span> </span><span class="hs-identifier hs-var">replicate</span><span> </span><a href="#local-6989586621679154558"><span class="hs-identifier hs-var">n</span></a><span> </span><span class="hs-string">&quot; very&quot;</span><span>
</span><a name="line-229"></a></pre></body></html>